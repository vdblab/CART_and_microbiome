<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Fig 3 | CART microbiome analysis</title>
  <meta name="description" content="." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Fig 3 | CART microbiome analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Fig 3 | CART microbiome analysis" />
  
  <meta name="twitter:description" content="." />
  

<meta name="author" content="Anqi Dai" />


<meta name="date" content="2021-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="fig-3.html"><a href="fig-3.html"><i class="fa fa-check"></i><b>2</b> Fig 3</a>
<ul>
<li class="chapter" data-level="2.1" data-path="fig-3.html"><a href="fig-3.html#b-stacked-bar-chart."><i class="fa fa-check"></i><b>2.1</b> 3B: stacked bar chart.</a></li>
<li class="chapter" data-level="2.2" data-path="fig-3.html"><a href="fig-3.html#c-alpha-and-beta-diversity-between-cart-patients-and-healthy-volunteers"><i class="fa fa-check"></i><b>2.2</b> 3C: alpha and beta diversity between CART patients and healthy volunteers</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="fig-3.html"><a href="fig-3.html#alpha-diversity-simpsons-reciprocal"><i class="fa fa-check"></i><b>2.2.1</b> alpha diversity (Simpson’s reciprocal)</a></li>
<li class="chapter" data-level="2.2.2" data-path="fig-3.html"><a href="fig-3.html#beta-diversity-pcoa-of-bray-curtis"><i class="fa fa-check"></i><b>2.2.2</b> beta diversity (PCOA of Bray-Curtis)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="fig-3.html"><a href="fig-3.html#fig-3-ef-lefse-analysis-with-taxa-abundance-at-asv-level"><i class="fa fa-check"></i><b>2.3</b> Fig 3 E&amp;F Lefse analysis with taxa abundance at ASV level</a></li>
<li class="chapter" data-level="2.4" data-path="fig-3.html"><a href="fig-3.html#fig-3d-bayesian-modeling-with-microbiome-alpha-diversity-as-predictor"><i class="fa fa-check"></i><b>2.4</b> Fig 3D Bayesian modeling with microbiome alpha diversity as predictor</a></li>
<li class="chapter" data-level="2.5" data-path="fig-3.html"><a href="fig-3.html#fig-3g-bayesian-modeling-with-5-genera-abundance-as-predictoroutcome-cr"><i class="fa fa-check"></i><b>2.5</b> Fig 3G Bayesian modeling with 5 genera abundance as predictor(outcome CR)</a></li>
<li class="chapter" data-level="2.6" data-path="fig-3.html"><a href="fig-3.html#fig3h-histogram-to-illustrate-the-predicted-probability-of-day100-cr"><i class="fa fa-check"></i><b>2.6</b> Fig3H Histogram to illustrate the predicted probability of day100 CR</a></li>
<li class="chapter" data-level="2.7" data-path="fig-3.html"><a href="fig-3.html#fig-3i-bayesian-modeling-with-5-genera-abundance-as-predictoroutcome-toxicity"><i class="fa fa-check"></i><b>2.7</b> Fig 3I Bayesian modeling with 5 genera abundance as predictor(outcome toxicity)</a></li>
<li class="chapter" data-level="2.8" data-path="fig-3.html"><a href="fig-3.html#fig3j-histogram-to-illustrate-the-predicted-probability-of-toxicity"><i class="fa fa-check"></i><b>2.8</b> Fig3J Histogram to illustrate the predicted probability of toxicity</a></li>
<li class="chapter" data-level="2.9" data-path="fig-3.html"><a href="fig-3.html#fig-3k-lefse-of-pathway-abundance-using-shotgun-data"><i class="fa fa-check"></i><b>2.9</b> Fig 3K lefse of pathway abundance using shotgun data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CART microbiome analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fig-3" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Fig 3</h1>
<div id="b-stacked-bar-chart." class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> 3B: stacked bar chart.</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="fig-3.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="fig-3.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdbR)</span>
<span id="cb2-3"><a href="fig-3.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb2-4"><a href="fig-3.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">connect_database</span>(<span class="st">&#39;~/dbConfig.txt&#39;</span>)</span>
<span id="cb2-5"><a href="fig-3.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&quot;asv_annotation_blast_color_ag&quot;</span>);</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="fig-3.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># my table of the CART stool cohort</span></span>
<span id="cb3-2"><a href="fig-3.html#cb3-2" aria-hidden="true" tabindex="-1"></a>stb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/amplicon/stool/combined_2_meta.csv&#39;</span>)</span>
<span id="cb3-3"><a href="fig-3.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the counts from database and also the color for the asv </span></span>
<span id="cb3-4"><a href="fig-3.html#cb3-4" aria-hidden="true" tabindex="-1"></a>counts_data <span class="ot">&lt;-</span> <span class="fu">get_counts_subset</span>(stb<span class="sc">$</span>sampleid)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="fig-3.html#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> counts_data <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="fig-3.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(asv_key<span class="sc">:</span>count_total, count_relative) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="fig-3.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(asv_annotation_blast_color_ag <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="fig-3.html#cb4-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(asv_key,color_label_group_distinct), <span class="at">by =</span> <span class="st">&quot;asv_key&quot;</span>)</span>
<span id="cb4-5"><a href="fig-3.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># there are some ASVs that don&#39;t have a color with it, but can use the color for the genus level</span></span>
<span id="cb4-6"><a href="fig-3.html#cb4-6" aria-hidden="true" tabindex="-1"></a>color_group <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="fig-3.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="fu">is.na</span>(.<span class="sc">$</span>color_label_group_distinct))</span>
<span id="cb4-8"><a href="fig-3.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># find the genus for these asv</span></span>
<span id="cb4-9"><a href="fig-3.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&#39;asv_annotation_blast_ag&#39;</span>)</span>
<span id="cb4-10"><a href="fig-3.html#cb4-10" aria-hidden="true" tabindex="-1"></a>no_color <span class="ot">&lt;-</span> color_group <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="fig-3.html#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">&#39;TRUE&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="fig-3.html#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(asv_key) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="fig-3.html#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(asv_annotation_blast_ag <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="fig-3.html#cb4-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(asv_key, genus)) </span>
<span id="cb4-15"><a href="fig-3.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># find the colors for these genera</span></span>
<span id="cb4-16"><a href="fig-3.html#cb4-16" aria-hidden="true" tabindex="-1"></a>genera_colors <span class="ot">&lt;-</span> no_color <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="fig-3.html#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(genus) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="fig-3.html#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(asv_annotation_blast_color_ag <span class="sc">%&gt;%</span> </span>
<span id="cb4-19"><a href="fig-3.html#cb4-19" aria-hidden="true" tabindex="-1"></a>               <span class="fu">distinct</span>(genus, color_label_group_distinct))</span>
<span id="cb4-20"><a href="fig-3.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># the full df for the no color genera</span></span>
<span id="cb4-21"><a href="fig-3.html#cb4-21" aria-hidden="true" tabindex="-1"></a>no_color_df <span class="ot">&lt;-</span> no_color <span class="sc">%&gt;%</span> </span>
<span id="cb4-22"><a href="fig-3.html#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(genera_colors)</span>
<span id="cb4-23"><a href="fig-3.html#cb4-23" aria-hidden="true" tabindex="-1"></a>no_color_df_full <span class="ot">&lt;-</span> color_group <span class="sc">%&gt;%</span> </span>
<span id="cb4-24"><a href="fig-3.html#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">&#39;TRUE&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-25"><a href="fig-3.html#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>color_label_group_distinct) <span class="sc">%&gt;%</span> </span>
<span id="cb4-26"><a href="fig-3.html#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(no_color_df <span class="sc">%&gt;%</span> </span>
<span id="cb4-27"><a href="fig-3.html#cb4-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(<span class="sc">-</span> genus))</span>
<span id="cb4-28"><a href="fig-3.html#cb4-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-29"><a href="fig-3.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># so if the genus is unknown then it&#39;s gonna be assigned &quot;other&quot; gray color  </span></span>
<span id="cb4-30"><a href="fig-3.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># the question is do we go one taxa level higher or make a new color base and shades for the new asv</span></span>
<span id="cb4-31"><a href="fig-3.html#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># after discussing with Tsoni, we decided that it&#39;s ok to assign gray to the unknown genus </span></span>
<span id="cb4-32"><a href="fig-3.html#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the new no_color_df_full to the original df</span></span>
<span id="cb4-33"><a href="fig-3.html#cb4-33" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb4-34"><a href="fig-3.html#cb4-34" aria-hidden="true" tabindex="-1"></a>  no_color_df_full,</span>
<span id="cb4-35"><a href="fig-3.html#cb4-35" aria-hidden="true" tabindex="-1"></a>  color_group <span class="sc">%&gt;%</span> </span>
<span id="cb4-36"><a href="fig-3.html#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">&#39;FALSE&#39;</span>)</span>
<span id="cb4-37"><a href="fig-3.html#cb4-37" aria-hidden="true" tabindex="-1"></a>)   </span>
<span id="cb4-38"><a href="fig-3.html#cb4-38" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span>  <span class="fu">write_csv</span>(<span class="st">&#39;data/the_data_to_make_panel_B.csv&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="fig-3.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the color palette (inherited from Ying, used in lots of project in our lab, the palette used in the NEJM paper Fig 2D https://www.nejm.org/doi/full/10.1056/NEJMoa1900623)</span></span>
<span id="cb5-2"><a href="fig-3.html#cb5-2" aria-hidden="true" tabindex="-1"></a>asv_color_set <span class="ot">&lt;-</span> asv_annotation_blast_color_ag <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="fig-3.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(color,color_label_group_distinct,color_label_group,color_base) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="fig-3.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(color_label_group_distinct, color) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="fig-3.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deframe</span>()</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="fig-3.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the beta diversity between the samples which deicide the order of the samples in the plot</span></span>
<span id="cb6-2"><a href="fig-3.html#cb6-2" aria-hidden="true" tabindex="-1"></a>cbd <span class="ot">&lt;-</span> <span class="fu">compute_beta_diversity_and_tsne</span>(<span class="at">sampleid =</span> dat<span class="sc">$</span>sampleid, </span>
<span id="cb6-3"><a href="fig-3.html#cb6-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">taxonomy =</span> dat<span class="sc">$</span>color_label_group_distinct,</span>
<span id="cb6-4"><a href="fig-3.html#cb6-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">count =</span> dat<span class="sc">$</span>count);</span>
<span id="cb6-5"><a href="fig-3.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#compute beta diversity</span></span>
<span id="cb6-6"><a href="fig-3.html#cb6-6" aria-hidden="true" tabindex="-1"></a>cbd<span class="sc">$</span><span class="fu">compute_beta_diversity</span>()</span></code></pre></div>
<pre><code>## Time:Composition_matrix:
## Time difference of 0.009370089 secs
## Time:Bray-Curtis matrix:
## Time difference of 0.002393007 secs</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="fig-3.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get beta diversity</span></span>
<span id="cb8-2"><a href="fig-3.html#cb8-2" aria-hidden="true" tabindex="-1"></a>d_beta <span class="ot">&lt;-</span> cbd<span class="sc">$</span><span class="fu">get_betadiversity</span>() </span>
<span id="cb8-3"><a href="fig-3.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#compute hierarchical cluster</span></span>
<span id="cb8-4"><a href="fig-3.html#cb8-4" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">as.dist</span>(d_beta), <span class="at">method =</span> <span class="st">&#39;complete&#39;</span>)</span>
<span id="cb8-5"><a href="fig-3.html#cb8-5" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc)</span>
<span id="cb8-6"><a href="fig-3.html#cb8-6" aria-hidden="true" tabindex="-1"></a>sample_dendogram_order <span class="ot">&lt;-</span> <span class="fu">labels</span>(dend)</span>
<span id="cb8-7"><a href="fig-3.html#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="fig-3.html#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="fig-3.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  dividing the samples to lower and higher diversity </span></span>
<span id="cb8-10"><a href="fig-3.html#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="fig-3.html#cb8-11" aria-hidden="true" tabindex="-1"></a>div_order <span class="ot">&lt;-</span> stb <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="fig-3.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(simpson_reciprocal) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="fig-3.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(sampleid)</span>
<span id="cb8-14"><a href="fig-3.html#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb8-15"><a href="fig-3.html#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># how about splitting the above dendrogram order into the low and higher diversity groups</span></span>
<span id="cb8-16"><a href="fig-3.html#cb8-16" aria-hidden="true" tabindex="-1"></a>div_med <span class="ot">&lt;-</span> <span class="fu">median</span>(stb<span class="sc">$</span>simpson_reciprocal)</span>
<span id="cb8-17"><a href="fig-3.html#cb8-17" aria-hidden="true" tabindex="-1"></a>lower_samp <span class="ot">&lt;-</span> stb <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="fig-3.html#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(simpson_reciprocal <span class="sc">&lt;=</span> div_med) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="fig-3.html#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(sampleid)</span>
<span id="cb8-20"><a href="fig-3.html#cb8-20" aria-hidden="true" tabindex="-1"></a>lower_samp_o <span class="ot">&lt;-</span> sample_dendogram_order[sample_dendogram_order <span class="sc">%in%</span> lower_samp]</span>
<span id="cb8-21"><a href="fig-3.html#cb8-21" aria-hidden="true" tabindex="-1"></a>higher_samp_o <span class="ot">&lt;-</span> sample_dendogram_order[<span class="sc">!</span>sample_dendogram_order <span class="sc">%in%</span> lower_samp]</span>
<span id="cb8-22"><a href="fig-3.html#cb8-22" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sampleid <span class="ot">=</span> <span class="fu">factor</span>(dat<span class="sc">$</span>sampleid,<span class="at">levels =</span> <span class="fu">c</span>(lower_samp_o, higher_samp_o))</span>
<span id="cb8-23"><a href="fig-3.html#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="fig-3.html#cb8-24" aria-hidden="true" tabindex="-1"></a>stacked_bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(sampleid, count_relative, <span class="at">fill =</span> color_label_group_distinct) ) <span class="sc">+</span></span>
<span id="cb8-25"><a href="fig-3.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;fill&quot;</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-26"><a href="fig-3.html#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb8-27"><a href="fig-3.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb8-28"><a href="fig-3.html#cb8-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&#39;Relative counts&#39;</span>) <span class="sc">+</span></span>
<span id="cb8-29"><a href="fig-3.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb8-30"><a href="fig-3.html#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-31"><a href="fig-3.html#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-32"><a href="fig-3.html#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> asv_color_set)</span>
<span id="cb8-33"><a href="fig-3.html#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="fig-3.html#cb8-34" aria-hidden="true" tabindex="-1"></a>stacked_bar</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="fig-3.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/stacked_bar_sorted_with_hclust_lower_and_higher_diversity.pdf&#39;</span>, <span class="at">plot =</span> stacked_bar,</span>
<span id="cb9-2"><a href="fig-3.html#cb9-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="c-alpha-and-beta-diversity-between-cart-patients-and-healthy-volunteers" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> 3C: alpha and beta diversity between CART patients and healthy volunteers</h2>
<div id="alpha-diversity-simpsons-reciprocal" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> alpha diversity (Simpson’s reciprocal)</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="fig-3.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdbR)</span>
<span id="cb10-2"><a href="fig-3.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">connect_database</span>(<span class="st">&#39;~/dbConfig.txt&#39;</span>)</span>
<span id="cb10-3"><a href="fig-3.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&quot;healthy_volunteers_ag&quot;</span>)</span>
<span id="cb10-4"><a href="fig-3.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&quot;asv_alpha_diversity_ag&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;table asv_alpha_diversity_ag is loaded and filtered for duplicates. Only the replicate of highest coverage is retained.&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="fig-3.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a total of 75 samples </span></span>
<span id="cb12-2"><a href="fig-3.html#cb12-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb12-3"><a href="fig-3.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  stb <span class="sc">%&gt;%</span> <span class="fu">select</span>(sampleid, simpson_reciprocal) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;baseline_CART&#39;</span>),</span>
<span id="cb12-4"><a href="fig-3.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  asv_alpha_diversity_ag <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="fig-3.html#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(sampleid, simpson_reciprocal) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="fig-3.html#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_volunteers_ag <span class="sc">%&gt;%</span> <span class="fu">select</span>(sampleid), <span class="at">by =</span> <span class="st">&quot;sampleid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="fig-3.html#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;healthy&#39;</span>)</span>
<span id="cb12-8"><a href="fig-3.html#cb12-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="fig-3.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sampleid, <span class="at">.keep_all =</span> T)</span>
<span id="cb12-10"><a href="fig-3.html#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="fig-3.html#cb12-11" aria-hidden="true" tabindex="-1"></a>alpha <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="fig-3.html#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggboxplot</span>(<span class="at">x =</span> <span class="st">&#39;grp&#39;</span>, <span class="at">y =</span> <span class="st">&#39;simpson_reciprocal&#39;</span>, <span class="at">add =</span> <span class="st">&#39;jitter&#39;</span>,</span>
<span id="cb12-13"><a href="fig-3.html#cb12-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">&#39;&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Fecal diversity (Simpson Reciprocal)&#39;</span>, <span class="at">xlab =</span> <span class="st">&#39;&#39;</span>, </span>
<span id="cb12-14"><a href="fig-3.html#cb12-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&#39;#ED0000&#39;</span>,<span class="st">&#39;#00468B&#39;</span>)) <span class="sc">+</span></span>
<span id="cb12-15"><a href="fig-3.html#cb12-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stat_compare_means</span>(<span class="at">comparisons=</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&#39;healthy&#39;</span>, <span class="st">&#39;baseline_CART&#39;</span>)),</span>
<span id="cb12-16"><a href="fig-3.html#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">label=</span> <span class="st">&quot;p.format&quot;</span>,</span>
<span id="cb12-17"><a href="fig-3.html#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span> <span class="st">&#39;wilcox.test&#39;</span>)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="beta-diversity-pcoa-of-bray-curtis" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> beta diversity (PCOA of Bray-Curtis)</h3>
<p>PCOA of Bray-Curtis distance with counts matrix at ASV level using an abundannce threshold of 0.01% and a prevalence threshold of 25% between healthy and CART cohort.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="fig-3.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdbR)</span>
<span id="cb13-2"><a href="fig-3.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">connect_database</span>(<span class="st">&#39;~/dbConfig.txt&#39;</span>)</span>
<span id="cb13-3"><a href="fig-3.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="fig-3.html#cb13-4" aria-hidden="true" tabindex="-1"></a>healthy <span class="ot">&lt;-</span> healthy_volunteers_ag <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="fig-3.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(asv_alpha_diversity_ag, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;sampleid&quot;</span>, <span class="st">&quot;oligos_id&quot;</span>)) </span>
<span id="cb13-6"><a href="fig-3.html#cb13-6" aria-hidden="true" tabindex="-1"></a>cts <span class="ot">&lt;-</span> <span class="fu">get_counts_subset</span>(<span class="fu">c</span>(stb<span class="sc">$</span>sampleid, healthy <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sampleid)))</span>
<span id="cb13-7"><a href="fig-3.html#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="fig-3.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># a total of 75 samples counts. there are 3 healthy samples I don&#39;t have count .</span></span>
<span id="cb13-9"><a href="fig-3.html#cb13-9" aria-hidden="true" tabindex="-1"></a>nsamp <span class="ot">&lt;-</span> cts <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="fig-3.html#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sampleid) <span class="sc">%&gt;%</span> </span>
<span id="cb13-11"><a href="fig-3.html#cb13-11" aria-hidden="true" tabindex="-1"></a>  nrow</span>
<span id="cb13-12"><a href="fig-3.html#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="fig-3.html#cb13-13" aria-hidden="true" tabindex="-1"></a>all_pheno <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(healthy <span class="sc">%&gt;%</span> </span>
<span id="cb13-14"><a href="fig-3.html#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleid) <span class="sc">%&gt;%</span> </span>
<span id="cb13-15"><a href="fig-3.html#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;healthy&#39;</span>, <span class="at">center =</span> <span class="st">&#39;healthy&#39;</span>),</span>
<span id="cb13-16"><a href="fig-3.html#cb13-16" aria-hidden="true" tabindex="-1"></a>  stb <span class="sc">%&gt;%</span> <span class="fu">select</span>(sampleid, center)  <span class="sc">%&gt;%</span> </span>
<span id="cb13-17"><a href="fig-3.html#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;CART&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-18"><a href="fig-3.html#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(sampleid, grp, center)</span>
<span id="cb13-19"><a href="fig-3.html#cb13-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-20"><a href="fig-3.html#cb13-20" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb13-21"><a href="fig-3.html#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sampleid, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb13-22"><a href="fig-3.html#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(asv_alpha_diversity_ag <span class="sc">%&gt;%</span> </span>
<span id="cb13-23"><a href="fig-3.html#cb13-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">distinct</span>(sampleid, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb13-24"><a href="fig-3.html#cb13-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">distinct</span>(path_pool, sampleid))</span>
<span id="cb13-25"><a href="fig-3.html#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="fig-3.html#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="fig-3.html#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># filter &gt;0.01% in more than 25% samples</span></span>
<span id="cb13-28"><a href="fig-3.html#cb13-28" aria-hidden="true" tabindex="-1"></a>keepa <span class="ot">&lt;-</span> cts <span class="sc">%&gt;%</span> </span>
<span id="cb13-29"><a href="fig-3.html#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_relative <span class="sc">&gt;</span> <span class="fl">0.0001</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-30"><a href="fig-3.html#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(asv_key) <span class="sc">%&gt;%</span> </span>
<span id="cb13-31"><a href="fig-3.html#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="fu">floor</span>(nsamp <span class="sc">*</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-32"><a href="fig-3.html#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(asv_key)</span>
<span id="cb13-33"><a href="fig-3.html#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="fig-3.html#cb13-34" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="ot">&lt;-</span> cts <span class="sc">%&gt;%</span> </span>
<span id="cb13-35"><a href="fig-3.html#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(asv_key <span class="sc">%in%</span> keepa) <span class="sc">%&gt;%</span> </span>
<span id="cb13-36"><a href="fig-3.html#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleid, asv_key,count_relative ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-37"><a href="fig-3.html#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> <span class="st">&#39;asv_key&#39;</span>, <span class="at">value =</span> <span class="st">&#39;count_relative&#39;</span>, <span class="at">fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-38"><a href="fig-3.html#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&#39;sampleid&#39;</span>)</span>
<span id="cb13-39"><a href="fig-3.html#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="fig-3.html#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb13-41"><a href="fig-3.html#cb13-41" aria-hidden="true" tabindex="-1"></a>dist_ <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(cts_fil, <span class="at">method =</span> <span class="st">&#39;bray&#39;</span>)</span>
<span id="cb13-42"><a href="fig-3.html#cb13-42" aria-hidden="true" tabindex="-1"></a>eigen <span class="ot">&lt;-</span> <span class="fu">pcoa</span>(dist_)<span class="sc">$</span>values<span class="sc">$</span>Eigenvalues</span>
<span id="cb13-43"><a href="fig-3.html#cb13-43" aria-hidden="true" tabindex="-1"></a>percent_var <span class="ot">&lt;-</span> <span class="fu">signif</span>(eigen<span class="sc">/</span><span class="fu">sum</span>(eigen), <span class="dv">3</span>)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb13-44"><a href="fig-3.html#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="fig-3.html#cb13-45" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(dist_, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb13-46"><a href="fig-3.html#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="fig-3.html#cb13-47" aria-hidden="true" tabindex="-1"></a>pcoa_two <span class="ot">&lt;-</span> bc <span class="sc">%&gt;%</span></span>
<span id="cb13-48"><a href="fig-3.html#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-49"><a href="fig-3.html#cb13-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&#39;sampleid&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-50"><a href="fig-3.html#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-51"><a href="fig-3.html#cb13-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(all_pheno) <span class="sc">%&gt;%</span> </span>
<span id="cb13-52"><a href="fig-3.html#cb13-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-53"><a href="fig-3.html#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggscatter</span>(<span class="at">x =</span> <span class="st">&#39;V1&#39;</span>, <span class="at">y =</span> <span class="st">&#39;V2&#39;</span>, <span class="at">color =</span>  <span class="st">&#39;grp&#39;</span>) <span class="sc">+</span></span>
<span id="cb13-54"><a href="fig-3.html#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;PCOA of healthy and CART patients&#39;</span>) <span class="sc">+</span></span>
<span id="cb13-55"><a href="fig-3.html#cb13-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC 1 [&quot;</span>,percent_var[<span class="dv">1</span>],<span class="st">&quot;%]&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-56"><a href="fig-3.html#cb13-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC 2 [&quot;</span>,percent_var[<span class="dv">2</span>],<span class="st">&quot;%]&quot;</span>)) </span>
<span id="cb13-57"><a href="fig-3.html#cb13-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme_void() +</span></span>
<span id="cb13-58"><a href="fig-3.html#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="fig-3.html#cb13-59" aria-hidden="true" tabindex="-1"></a>pcoa_two</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="fig-3.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/PCOA(bray-curtis) of healthy and CART patients.pdf&#39;</span>, <span class="at">plot =</span> pcoa_two)</span></code></pre></div>
<p>The PCOA with only CART patients data using the same filtering threshold but colored with the different pools they are sequenced from.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="fig-3.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a pcoa at asv level to show they are from different pools and well mixed </span></span>
<span id="cb15-2"><a href="fig-3.html#cb15-2" aria-hidden="true" tabindex="-1"></a>cts <span class="ot">&lt;-</span> <span class="fu">get_counts_subset</span>(<span class="fu">c</span>(stb<span class="sc">$</span>sampleid))</span>
<span id="cb15-3"><a href="fig-3.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="fig-3.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter &gt;0.01% in more than 25% samples</span></span>
<span id="cb15-5"><a href="fig-3.html#cb15-5" aria-hidden="true" tabindex="-1"></a>keepa <span class="ot">&lt;-</span> cts <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="fig-3.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_relative <span class="sc">&gt;</span> <span class="fl">0.0001</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="fig-3.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(asv_key) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="fig-3.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="fu">floor</span>(nsamp <span class="sc">*</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="fig-3.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(asv_key)</span>
<span id="cb15-10"><a href="fig-3.html#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="fig-3.html#cb15-11" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="ot">&lt;-</span> cts <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="fig-3.html#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(asv_key <span class="sc">%in%</span> keepa) <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="fig-3.html#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleid, asv_key,count_relative ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="fig-3.html#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> <span class="st">&#39;asv_key&#39;</span>, <span class="at">value =</span> <span class="st">&#39;count_relative&#39;</span>, <span class="at">fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="fig-3.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&#39;sampleid&#39;</span>)</span>
<span id="cb15-16"><a href="fig-3.html#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="fig-3.html#cb15-17" aria-hidden="true" tabindex="-1"></a>dist_ <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(cts_fil, <span class="at">method =</span> <span class="st">&#39;bray&#39;</span>)</span>
<span id="cb15-18"><a href="fig-3.html#cb15-18" aria-hidden="true" tabindex="-1"></a>eigen <span class="ot">&lt;-</span> <span class="fu">pcoa</span>(dist_)<span class="sc">$</span>values<span class="sc">$</span>Eigenvalues</span>
<span id="cb15-19"><a href="fig-3.html#cb15-19" aria-hidden="true" tabindex="-1"></a>percent_var <span class="ot">&lt;-</span> <span class="fu">signif</span>(eigen<span class="sc">/</span><span class="fu">sum</span>(eigen), <span class="dv">3</span>)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb15-20"><a href="fig-3.html#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="fig-3.html#cb15-21" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(dist_, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb15-22"><a href="fig-3.html#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="fig-3.html#cb15-23" aria-hidden="true" tabindex="-1"></a>mp <span class="ot">&lt;-</span> bc <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="fig-3.html#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-25"><a href="fig-3.html#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&#39;sampleid&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-26"><a href="fig-3.html#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-27"><a href="fig-3.html#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(all_pheno) <span class="sc">%&gt;%</span> </span>
<span id="cb15-28"><a href="fig-3.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sampleid, <span class="at">.keep_all =</span> T)  <span class="sc">%&gt;%</span> </span>
<span id="cb15-29"><a href="fig-3.html#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pool =</span> <span class="fu">str_extract</span>(path_pool, <span class="st">&#39;Sample.+/&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-30"><a href="fig-3.html#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pool =</span> <span class="fu">str_replace</span>(pool, <span class="st">&#39;Sample_&#39;</span>,<span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-31"><a href="fig-3.html#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pool =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(pool, <span class="st">&#39;IGO&#39;</span>), <span class="fu">str_extract</span>(pool, <span class="st">&#39;IGO.+$&#39;</span>), pool)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-32"><a href="fig-3.html#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pool =</span> <span class="fu">str_replace</span>(pool, <span class="st">&#39;_1/|_comple.+$&#39;</span>,<span class="st">&#39;&#39;</span>))</span>
<span id="cb15-33"><a href="fig-3.html#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="fig-3.html#cb15-34" aria-hidden="true" tabindex="-1"></a>pcoa_cart <span class="ot">&lt;-</span> mp <span class="sc">%&gt;%</span> </span>
<span id="cb15-35"><a href="fig-3.html#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggscatter</span>(<span class="at">x =</span> <span class="st">&#39;V1&#39;</span>, <span class="at">y =</span> <span class="st">&#39;V2&#39;</span>, <span class="at">color =</span>  <span class="st">&#39;pool&#39;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb15-36"><a href="fig-3.html#cb15-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;PCOA of CART patients&#39;</span>) <span class="sc">+</span></span>
<span id="cb15-37"><a href="fig-3.html#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC 1 [&quot;</span>,percent_var[<span class="dv">1</span>],<span class="st">&quot;%]&quot;</span>)) <span class="sc">+</span></span>
<span id="cb15-38"><a href="fig-3.html#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC 2 [&quot;</span>,percent_var[<span class="dv">2</span>],<span class="st">&quot;%]&quot;</span>)) </span>
<span id="cb15-39"><a href="fig-3.html#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme_void() +</span></span>
<span id="cb15-40"><a href="fig-3.html#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="fig-3.html#cb15-41" aria-hidden="true" tabindex="-1"></a>pcoa_cart</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="fig-3.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/PCOA(bray-curtis) (ASV level)of CART patients_pool.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">height =</span> <span class="dv">9</span>, <span class="at">plot =</span> pcoa_cart)</span></code></pre></div>
</div>
</div>
<div id="fig-3-ef-lefse-analysis-with-taxa-abundance-at-asv-level" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Fig 3 E&amp;F Lefse analysis with taxa abundance at ASV level</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="fig-3.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-2"><a href="fig-3.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="fig-3.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort out the asv counts table and also do filtering (need to have all taxa levels)</span></span>
<span id="cb18-2"><a href="fig-3.html#cb18-2" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/amplicon/stool/combined_2_meta.csv&#39;</span>)</span>
<span id="cb18-3"><a href="fig-3.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="fig-3.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdbR)</span>
<span id="cb18-5"><a href="fig-3.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">connect_database</span>(<span class="st">&#39;~/dbConfig.txt&#39;</span>)</span>
<span id="cb18-6"><a href="fig-3.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&#39;asv_annotation_blast_ag&#39;</span>)</span>
<span id="cb18-7"><a href="fig-3.html#cb18-7" aria-hidden="true" tabindex="-1"></a>cts <span class="ot">&lt;-</span> <span class="fu">get_counts_subset</span>(meta<span class="sc">$</span>sampleid)</span>
<span id="cb18-8"><a href="fig-3.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="fig-3.html#cb18-9" aria-hidden="true" tabindex="-1"></a>cts_ <span class="ot">&lt;-</span> cts <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="fig-3.html#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(asv_key, sampleid, count_relative) <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="fig-3.html#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> <span class="st">&#39;sampleid&#39;</span>, <span class="at">value =</span> <span class="st">&#39;count_relative&#39;</span>, <span class="at">fill =</span> <span class="dv">0</span>) </span>
<span id="cb18-12"><a href="fig-3.html#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="fig-3.html#cb18-13" aria-hidden="true" tabindex="-1"></a>annot <span class="ot">&lt;-</span> asv_annotation_blast_ag <span class="sc">%&gt;%</span> </span>
<span id="cb18-14"><a href="fig-3.html#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(asv_key <span class="sc">%in%</span> cts_<span class="sc">$</span>asv_key) <span class="sc">%&gt;%</span> </span>
<span id="cb18-15"><a href="fig-3.html#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ordr =</span>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(ordr), <span class="fu">str_glue</span>(<span class="st">&#39;unknown_of_class_{class}&#39;</span>), ordr),</span>
<span id="cb18-16"><a href="fig-3.html#cb18-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(family), <span class="fu">str_glue</span>(<span class="st">&#39;unknown_of_order_{ordr}&#39;</span>), family),</span>
<span id="cb18-17"><a href="fig-3.html#cb18-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">genus =</span>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(genus) , <span class="fu">str_glue</span>(<span class="st">&#39;unknown_of_family_{family}&#39;</span>), genus),</span>
<span id="cb18-18"><a href="fig-3.html#cb18-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">species =</span>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(species) , <span class="fu">str_glue</span>(<span class="st">&#39;unknown_of_genus_{genus}&#39;</span>), species)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-19"><a href="fig-3.html#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">taxa_asv =</span> <span class="fu">str_glue</span>(<span class="st">&#39;k__{kingdom}|p__{phylum}|c__{class}|o__{ordr}|f__{family}|g__{genus}|s__{species}|a__{asv_key}&#39;</span>))</span>
<span id="cb18-20"><a href="fig-3.html#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="fig-3.html#cb18-21" aria-hidden="true" tabindex="-1"></a>cts_all <span class="ot">&lt;-</span> cts_ <span class="sc">%&gt;%</span> </span>
<span id="cb18-22"><a href="fig-3.html#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(annot <span class="sc">%&gt;%</span>  <span class="fu">select</span>(asv_key, taxa_asv), <span class="at">by  =</span> <span class="st">&#39;asv_key&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-23"><a href="fig-3.html#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>asv_key)  <span class="sc">%&gt;%</span> </span>
<span id="cb18-24"><a href="fig-3.html#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;relab&#39;</span>, <span class="fu">names</span>(.)[<span class="dv">1</span>]<span class="sc">:</span><span class="fu">names</span>(.)[<span class="fu">ncol</span>(.)<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb18-25"><a href="fig-3.html#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(meta <span class="sc">%&gt;%</span> <span class="fu">select</span>(sampleid, cr_d100, toxicity), <span class="at">by =</span> <span class="st">&#39;sampleid&#39;</span>)</span>
<span id="cb18-26"><a href="fig-3.html#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="fig-3.html#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="fig-3.html#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># the asv to keep</span></span>
<span id="cb18-29"><a href="fig-3.html#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co"># keep the asvs that show up in at least 25% of the samples</span></span>
<span id="cb18-30"><a href="fig-3.html#cb18-30" aria-hidden="true" tabindex="-1"></a>keepg <span class="ot">&lt;-</span> cts_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-31"><a href="fig-3.html#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relab <span class="sc">&gt;</span> <span class="fl">0.0001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-32"><a href="fig-3.html#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-33"><a href="fig-3.html#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(taxa_asv) <span class="sc">%&gt;%</span> </span>
<span id="cb18-34"><a href="fig-3.html#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(meta) <span class="sc">*</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-35"><a href="fig-3.html#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(taxa_asv)</span>
<span id="cb18-36"><a href="fig-3.html#cb18-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb18-37"><a href="fig-3.html#cb18-37" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="ot">&lt;-</span> cts_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-38"><a href="fig-3.html#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(taxa_asv <span class="sc">%in%</span> keepg) <span class="sc">%&gt;%</span> </span>
<span id="cb18-39"><a href="fig-3.html#cb18-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;relab&#39;</span>, <span class="at">fill =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="fig-3.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the pheno label for the samples</span></span>
<span id="cb19-2"><a href="fig-3.html#cb19-2" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="fig-3.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(center, cr_d100<span class="sc">:</span>crs, icans, sampleid) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="fig-3.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;pheno&#39;</span>, <span class="st">&#39;value&#39;</span>, cr_d100<span class="sc">:</span>icans) </span>
<span id="cb19-5"><a href="fig-3.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="fig-3.html#cb19-6" aria-hidden="true" tabindex="-1"></a>all_sub_pheno <span class="ot">&lt;-</span> pheno <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="fig-3.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(., <span class="fu">list</span>(.<span class="sc">$</span>pheno)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="fig-3.html#cb19-8" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">imap</span>(<span class="sc">~</span> <span class="fu">filter</span>(<span class="at">.data =</span> ., value <span class="sc">!=</span> <span class="st">&#39;not_assessed&#39;</span>))</span>
<span id="cb19-9"><a href="fig-3.html#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="fig-3.html#cb19-10" aria-hidden="true" tabindex="-1"></a>tpheno <span class="ot">&lt;-</span> all_sub_pheno <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="fig-3.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="cf">function</span>(.x, .y){</span>
<span id="cb19-12"><a href="fig-3.html#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">.data =</span> .x, value) <span class="sc">%&gt;%</span> </span>
<span id="cb19-13"><a href="fig-3.html#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">write.table</span>(<span class="fu">str_glue</span>(<span class="st">&#39;data/amplicon/lefse/pull_{.y}.txt&#39;</span>), <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F, <span class="at">row.names =</span> T, <span class="at">col.names =</span> F)</span>
<span id="cb19-14"><a href="fig-3.html#cb19-14" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-15"><a href="fig-3.html#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="fig-3.html#cb19-16" aria-hidden="true" tabindex="-1"></a>tcts <span class="ot">&lt;-</span> all_sub_pheno <span class="sc">%&gt;%</span> </span>
<span id="cb19-17"><a href="fig-3.html#cb19-17" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">pull</span>(<span class="at">.data =</span> ., sampleid) ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-18"><a href="fig-3.html#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="sc">~</span> cts_fil <span class="sc">%&gt;%</span> <span class="fu">select</span>(taxa_asv, <span class="fu">matches</span>(.x)) <span class="sc">%&gt;%</span>  <span class="fu">write_tsv</span>(<span class="fu">str_glue</span>(<span class="st">&#39;data/amplicon/lefse/{.y}_asv_tcts.tsv&#39;</span>))) </span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="fig-3.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> data/amplicon/lefse/pull_toxicity.txt data/amplicon/lefse/toxicity_asv_tcts.tsv <span class="op">&gt;</span> data/amplicon/lefse/pull_toxicity_asv_tcts.tsv</span>
<span id="cb20-2"><a href="fig-3.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> data/amplicon/lefse/pull_cr_d100.txt data/amplicon/lefse/cr_d100_asv_tcts.tsv <span class="op">&gt;</span> data/amplicon/lefse/pull_cr_d100_asv_tcts.tsv </span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="fig-3.html#cb21-1" aria-hidden="true" tabindex="-1"></a>fns <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&#39;data/amplicon/lefse/&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;pull.*_asv_tcts.tsv$&#39;</span>)</span>
<span id="cb21-2"><a href="fig-3.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="fig-3.html#cb21-3" aria-hidden="true" tabindex="-1"></a>cmds <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-4"><a href="fig-3.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fns =</span> fns</span>
<span id="cb21-5"><a href="fig-3.html#cb21-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="fig-3.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">format_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_format_input.py {fns}  {fns}.in -c 1  -u 2 -o 1000000   &#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="fig-3.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">run_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_run.py -l  4 {fns}.in  {fns}.res&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="fig-3.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">plot_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_plot_res.py {fns}.res {fns}.pdf --format pdf  --feature_font_size 4 --width 10 --dpi 300 --title {fns}&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-9"><a href="fig-3.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clado_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_plot_cladogram.py {fns}.res {fns}_clado.pdf  --label_font_size 4 --dpi 300 --format pdf --title {fns}&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="fig-3.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fns) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="fig-3.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-12"><a href="fig-3.html#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="fig-3.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&#39;data/amplicon/lefse/lefse_run_cmd_taxa.sh&#39;</span>, <span class="at">col_names =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="fig-3.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run in terminal:</span></span>
<span id="cb22-2"><a href="fig-3.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># bash /Users/daia1/projects/CART_and_microbiome/data/amplicon/lefse/lefse_run_cmd_taxa.sh</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="fig-3.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the results in ggplot</span></span>
<span id="cb23-2"><a href="fig-3.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the input : lefse res files</span></span>
<span id="cb23-3"><a href="fig-3.html#cb23-3" aria-hidden="true" tabindex="-1"></a>fns <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&#39;data/amplicon/lefse/&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;pull.*_asv_tcts.tsv.res$&#39;</span>, <span class="at">full.names =</span> T)</span>
<span id="cb23-4"><a href="fig-3.html#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="fig-3.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># join all of the tables feature together</span></span>
<span id="cb23-6"><a href="fig-3.html#cb23-6" aria-hidden="true" tabindex="-1"></a>feature <span class="ot">&lt;-</span> fns <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="fig-3.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(fns) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="fig-3.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">read_tsv</span>(., <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&#39;feature&#39;</span>,<span class="st">&#39;xx&#39;</span>,<span class="st">&#39;direction&#39;</span>,<span class="st">&#39;score&#39;</span>,<span class="st">&#39;pval&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="fig-3.html#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(score))) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="fig-3.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;group&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="fig-3.html#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_replace</span>(group, <span class="st">&#39;data/amplicon/lefse//pull_&#39;</span>,<span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="fig-3.html#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_replace</span>(group, <span class="st">&#39;_asv_tcts.tsv.res$&#39;</span>,<span class="st">&#39;&#39;</span>)) </span>
<span id="cb23-13"><a href="fig-3.html#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="fig-3.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># change the &quot;N&quot; direction to be minus score</span></span>
<span id="cb23-15"><a href="fig-3.html#cb23-15" aria-hidden="true" tabindex="-1"></a>feature <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb23-16"><a href="fig-3.html#cb23-16" aria-hidden="true" tabindex="-1"></a>  feature <span class="sc">%&gt;%</span> </span>
<span id="cb23-17"><a href="fig-3.html#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.<span class="sc">$</span>direction) <span class="sc">%&gt;%</span> </span>
<span id="cb23-18"><a href="fig-3.html#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">&#39;no&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-19"><a href="fig-3.html#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">score =</span> <span class="sc">-</span>score),</span>
<span id="cb23-20"><a href="fig-3.html#cb23-20" aria-hidden="true" tabindex="-1"></a>  feature <span class="sc">%&gt;%</span> </span>
<span id="cb23-21"><a href="fig-3.html#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.<span class="sc">$</span>direction) <span class="sc">%&gt;%</span> </span>
<span id="cb23-22"><a href="fig-3.html#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">&#39;yes&#39;</span>)  </span>
<span id="cb23-23"><a href="fig-3.html#cb23-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-24"><a href="fig-3.html#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(group, feature, score) <span class="sc">%&gt;%</span> </span>
<span id="cb23-25"><a href="fig-3.html#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">str_replace_all</span>(feature, <span class="st">&#39;^.+</span><span class="sc">\\</span><span class="st">.&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb23-26"><a href="fig-3.html#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="fig-3.html#cb23-27" aria-hidden="true" tabindex="-1"></a>all_title_fs <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb23-28"><a href="fig-3.html#cb23-28" aria-hidden="true" tabindex="-1"></a>axis_text_fs <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb23-29"><a href="fig-3.html#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="fig-3.html#cb23-30" aria-hidden="true" tabindex="-1"></a>CR <span class="ot">&lt;-</span> feature <span class="sc">%&gt;%</span> </span>
<span id="cb23-31"><a href="fig-3.html#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&#39;cr_d100&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-32"><a href="fig-3.html#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, score), <span class="at">y =</span> score, <span class="at">fill =</span> direction)) <span class="sc">+</span></span>
<span id="cb23-33"><a href="fig-3.html#cb23-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_bar</span>( <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb23-34"><a href="fig-3.html#cb23-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb23-35"><a href="fig-3.html#cb23-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#925E9F&#39;</span>, <span class="st">&#39;#42B540&#39;</span>))  <span class="sc">+</span></span>
<span id="cb23-36"><a href="fig-3.html#cb23-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#925E9F&#39;</span>, <span class="st">&#39;#42B540&#39;</span>)) <span class="sc">+</span></span>
<span id="cb23-37"><a href="fig-3.html#cb23-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb23-38"><a href="fig-3.html#cb23-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb23-39"><a href="fig-3.html#cb23-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span>all_title_fs),</span>
<span id="cb23-40"><a href="fig-3.html#cb23-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb23-41"><a href="fig-3.html#cb23-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb23-42"><a href="fig-3.html#cb23-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.position=</span><span class="st">&#39;bottom&#39;</span>) <span class="sc">+</span></span>
<span id="cb23-43"><a href="fig-3.html#cb23-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">str_glue</span>(<span class="st">&#39;Response to CR&#39;</span>) ,</span>
<span id="cb23-44"><a href="fig-3.html#cb23-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="st">&#39;Score&#39;</span>)</span>
<span id="cb23-45"><a href="fig-3.html#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="fig-3.html#cb23-46" aria-hidden="true" tabindex="-1"></a>CR</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="fig-3.html#cb24-1" aria-hidden="true" tabindex="-1"></a>tox <span class="ot">&lt;-</span> feature <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="fig-3.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&#39;toxicity&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="fig-3.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, score), <span class="at">y =</span> score, <span class="at">fill =</span> direction)) <span class="sc">+</span></span>
<span id="cb24-4"><a href="fig-3.html#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="fig-3.html#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb24-6"><a href="fig-3.html#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#0099B4&#39;</span>, <span class="st">&#39;#AD002A&#39;</span>))  <span class="sc">+</span></span>
<span id="cb24-7"><a href="fig-3.html#cb24-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#0099B4&#39;</span>, <span class="st">&#39;#AD002A&#39;</span>)) <span class="sc">+</span></span>
<span id="cb24-8"><a href="fig-3.html#cb24-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb24-9"><a href="fig-3.html#cb24-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb24-10"><a href="fig-3.html#cb24-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb24-11"><a href="fig-3.html#cb24-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span>all_title_fs),</span>
<span id="cb24-12"><a href="fig-3.html#cb24-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb24-13"><a href="fig-3.html#cb24-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="fig-3.html#cb24-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">str_glue</span>(<span class="st">&#39;Response to Toxicity&#39;</span>) ,</span>
<span id="cb24-15"><a href="fig-3.html#cb24-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="st">&#39;Score&#39;</span>)</span>
<span id="cb24-16"><a href="fig-3.html#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="fig-3.html#cb24-17" aria-hidden="true" tabindex="-1"></a>tox</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="fig-3.html#cb25-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(CR,tox,  </span>
<span id="cb25-2"><a href="fig-3.html#cb25-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb25-3"><a href="fig-3.html#cb25-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">&#39;hv&#39;</span>,</span>
<span id="cb25-4"><a href="fig-3.html#cb25-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">1.8</span>,<span class="fl">1.2</span>),</span>
<span id="cb25-5"><a href="fig-3.html#cb25-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis =</span> <span class="st">&#39;b&#39;</span>)  </span>
<span id="cb25-6"><a href="fig-3.html#cb25-6" aria-hidden="true" tabindex="-1"></a>g</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-19-3.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="fig-3.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/16s_lefse_combined.pdf&#39;</span>, <span class="at">device =</span> <span class="st">&#39;pdf&#39;</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">width =</span> <span class="dv">15</span>, <span class="at">plot =</span> g)</span></code></pre></div>
<p>It is important to check the relative abundance of the significant taxa visually.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="fig-3.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to see the relative abundance of those taxa </span></span>
<span id="cb27-2"><a href="fig-3.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to get the top and bottom three taxa of the lefse results</span></span>
<span id="cb27-3"><a href="fig-3.html#cb27-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&#39;data/amplicon/lefse/&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;asv_tcts.tsv.res$&#39;</span>, <span class="at">full.names =</span> T)</span>
<span id="cb27-4"><a href="fig-3.html#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="fig-3.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># gather the species level taxa in the lefse significant results</span></span>
<span id="cb27-6"><a href="fig-3.html#cb27-6" aria-hidden="true" tabindex="-1"></a>res_all <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb27-7"><a href="fig-3.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(res) <span class="sc">%&gt;%</span> </span>
<span id="cb27-8"><a href="fig-3.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">read_tsv</span>(., <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&#39;feature&#39;</span>,<span class="st">&#39;xx&#39;</span>,<span class="st">&#39;direction&#39;</span>,<span class="st">&#39;score&#39;</span>,<span class="st">&#39;pval&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="fig-3.html#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(score))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-10"><a href="fig-3.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(<span class="sc">~</span> <span class="fu">nrow</span>(.) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-11"><a href="fig-3.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;res&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-12"><a href="fig-3.html#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> <span class="fu">str_replace</span>(res, <span class="st">&#39;^.+//&#39;</span>,<span class="st">&#39;&#39;</span>),</span>
<span id="cb27-13"><a href="fig-3.html#cb27-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">res =</span> <span class="fu">str_replace</span>(res, <span class="st">&#39;_asv.+$&#39;</span>,<span class="st">&#39;&#39;</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb27-14"><a href="fig-3.html#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">grp =</span> res) <span class="sc">%&gt;%</span> </span>
<span id="cb27-15"><a href="fig-3.html#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(grp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;pull_cr_d100&#39;</span>,<span class="st">&#39;pull_toxicity&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="fig-3.html#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">str_replace_all</span>(feature, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>,<span class="st">&#39;</span><span class="sc">\\</span><span class="st">|&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-17"><a href="fig-3.html#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#split(., list(.$grp, .$direction)) %&gt;% </span></span>
<span id="cb27-18"><a href="fig-3.html#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#map_dfr(~ top_n(x = ., n = 4, wt = score) %&gt;% arrange(-score)) %&gt;% </span></span>
<span id="cb27-19"><a href="fig-3.html#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(str_detect(feature, &#39;s__.+$&#39;)) %&gt;% </span></span>
<span id="cb27-20"><a href="fig-3.html#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!str_detect(feature, &#39;a__.+$&#39;)) %&gt;% </span></span>
<span id="cb27-21"><a href="fig-3.html#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(feature, <span class="st">&#39;g__.+$&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-22"><a href="fig-3.html#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(feature, <span class="st">&#39;s__.+$&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-23"><a href="fig-3.html#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">str_replace</span>(feature, <span class="st">&#39;^.+g__&#39;</span>,<span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-24"><a href="fig-3.html#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">str_replace</span>(feature, <span class="st">&#39;_Clostridium_&#39;</span>, <span class="st">&#39;[Clostridium]&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-25"><a href="fig-3.html#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb27-26"><a href="fig-3.html#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="fig-3.html#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="fig-3.html#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the relab of those taxa (at species level) in boxplot</span></span>
<span id="cb27-29"><a href="fig-3.html#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co"># get the species counts of the sampels</span></span>
<span id="cb27-30"><a href="fig-3.html#cb27-30" aria-hidden="true" tabindex="-1"></a>cts_spp <span class="ot">&lt;-</span> cts_ <span class="sc">%&gt;%</span> </span>
<span id="cb27-31"><a href="fig-3.html#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(annot <span class="sc">%&gt;%</span>  <span class="fu">select</span>(asv_key, species), <span class="at">by  =</span> <span class="st">&#39;asv_key&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-32"><a href="fig-3.html#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>asv_key)  <span class="sc">%&gt;%</span> </span>
<span id="cb27-33"><a href="fig-3.html#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;relab&#39;</span>, <span class="fu">names</span>(.)[<span class="dv">1</span>]<span class="sc">:</span><span class="fu">names</span>(.)[<span class="fu">ncol</span>(.)<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb27-34"><a href="fig-3.html#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sampleid, species) <span class="sc">%&gt;%</span> </span>
<span id="cb27-35"><a href="fig-3.html#cb27-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Relab =</span> <span class="fu">sum</span>(relab)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-36"><a href="fig-3.html#cb27-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleid, species, Relab) <span class="sc">%&gt;%</span> </span>
<span id="cb27-37"><a href="fig-3.html#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(meta <span class="sc">%&gt;%</span> <span class="fu">select</span>(sampleid, cr_d100, toxicity), <span class="at">by =</span> <span class="st">&#39;sampleid&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-38"><a href="fig-3.html#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb27-39"><a href="fig-3.html#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="fig-3.html#cb27-40" aria-hidden="true" tabindex="-1"></a>cts_genus <span class="ot">&lt;-</span> cts_ <span class="sc">%&gt;%</span> </span>
<span id="cb27-41"><a href="fig-3.html#cb27-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(annot <span class="sc">%&gt;%</span>  <span class="fu">select</span>(asv_key, genus), <span class="at">by  =</span> <span class="st">&#39;asv_key&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-42"><a href="fig-3.html#cb27-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>asv_key)  <span class="sc">%&gt;%</span> </span>
<span id="cb27-43"><a href="fig-3.html#cb27-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;relab&#39;</span>, <span class="fu">names</span>(.)[<span class="dv">1</span>]<span class="sc">:</span><span class="fu">names</span>(.)[<span class="fu">ncol</span>(.)<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb27-44"><a href="fig-3.html#cb27-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sampleid, genus) <span class="sc">%&gt;%</span> </span>
<span id="cb27-45"><a href="fig-3.html#cb27-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Relab =</span> <span class="fu">sum</span>(relab)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-46"><a href="fig-3.html#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleid, genus, Relab) <span class="sc">%&gt;%</span> </span>
<span id="cb27-47"><a href="fig-3.html#cb27-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(meta <span class="sc">%&gt;%</span> <span class="fu">select</span>(sampleid, cr_d100, toxicity), <span class="at">by =</span> <span class="st">&#39;sampleid&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-48"><a href="fig-3.html#cb27-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb27-49"><a href="fig-3.html#cb27-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-50"><a href="fig-3.html#cb27-50" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">&lt;-</span> cts_genus <span class="sc">%&gt;%</span> </span>
<span id="cb27-51"><a href="fig-3.html#cb27-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(res_all, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;genus&#39;</span> <span class="ot">=</span> <span class="st">&#39;feature&#39;</span>))</span>
<span id="cb27-52"><a href="fig-3.html#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="fig-3.html#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="co"># finally I can do the plotting</span></span>
<span id="cb27-54"><a href="fig-3.html#cb27-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-55"><a href="fig-3.html#cb27-55" aria-hidden="true" tabindex="-1"></a>pull_cr_d100 <span class="ot">&lt;-</span> joined  <span class="sc">%&gt;%</span></span>
<span id="cb27-56"><a href="fig-3.html#cb27-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(grp <span class="sc">==</span> <span class="st">&#39;pull_cr_d100&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-57"><a href="fig-3.html#cb27-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggboxplot</span>(<span class="at">x =</span> <span class="st">&#39;cr_d100&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Relab&#39;</span>, <span class="at">add =</span> <span class="st">&#39;jitter&#39;</span>, <span class="at">title =</span> <span class="st">&#39;Outcome: cr_d100&#39;</span>) <span class="sc">+</span></span>
<span id="cb27-58"><a href="fig-3.html#cb27-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(direction <span class="sc">~</span> genus, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>) </span>
<span id="cb27-59"><a href="fig-3.html#cb27-59" aria-hidden="true" tabindex="-1"></a>pull_cr_d100 </span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="fig-3.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/lefse_taxa_crd100.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">13</span>, <span class="at">plot =</span> pull_cr_d100)</span></code></pre></div>
<p>As can be observed in the boxplot, patients that had a CR have higher median relative abundance in Ruminococcus.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="fig-3.html#cb29-1" aria-hidden="true" tabindex="-1"></a>pull_toxicity <span class="ot">&lt;-</span> joined  <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="fig-3.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(grp <span class="sc">==</span> <span class="st">&#39;pull_toxicity&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="fig-3.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggboxplot</span>(<span class="at">x =</span> <span class="st">&#39;toxicity&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Relab&#39;</span>, <span class="at">add =</span> <span class="st">&#39;jitter&#39;</span>, <span class="at">title =</span> <span class="st">&#39;Outcome: toxicity&#39;</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="fig-3.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(direction <span class="sc">~</span> genus, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>) </span>
<span id="cb29-5"><a href="fig-3.html#cb29-5" aria-hidden="true" tabindex="-1"></a>pull_toxicity  </span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="fig-3.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/lefse_taxa_toxicity.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">13</span>, <span class="at">plot =</span> pull_toxicity)</span></code></pre></div>
<p>As can be observed in the boxplot, patients that had a toxicity response have clearly higher median relative abundance in Bacteroides.</p>
</div>
<div id="fig-3d-bayesian-modeling-with-microbiome-alpha-diversity-as-predictor" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Fig 3D Bayesian modeling with microbiome alpha diversity as predictor</h2>
<p>The formular is: CR/Toxicity ~ alpha diversity + center</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="fig-3.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb31-2"><a href="fig-3.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb31-3"><a href="fig-3.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb31-4"><a href="fig-3.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb31-5"><a href="fig-3.html#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="fig-3.html#cb31-6" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/amplicon/stool/combined_2_meta.csv&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="fig-3.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logdiv_s =</span> <span class="fu">scale</span>(<span class="fu">log</span>(simpson_reciprocal))) <span class="sc">%&gt;%</span>  </span>
<span id="cb31-8"><a href="fig-3.html#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logdiv_s =</span> <span class="fu">as.numeric</span>(logdiv_s)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="fig-3.html#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tox =</span> <span class="fu">if_else</span>(toxicity <span class="sc">==</span> <span class="st">&#39;yes&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-10"><a href="fig-3.html#cb31-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">cr100 =</span> <span class="fu">if_else</span>(cr_d100 <span class="sc">==</span> <span class="st">&#39;yes&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-11"><a href="fig-3.html#cb31-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">loca =</span> <span class="fu">if_else</span>(center <span class="sc">==</span> <span class="st">&#39;M&#39;</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span>  <span class="co"># MSK 1 ; Upenn 2</span></span>
<span id="cb31-12"><a href="fig-3.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">center =</span> <span class="fu">factor</span>(center),</span>
<span id="cb31-13"><a href="fig-3.html#cb31-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">toxicity =</span> <span class="fu">factor</span>(toxicity, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;no&#39;</span>,<span class="st">&#39;yes&#39;</span>)),</span>
<span id="cb31-14"><a href="fig-3.html#cb31-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">cr_d100 =</span> <span class="fu">factor</span>(cr_d100, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;no&#39;</span>,<span class="st">&#39;yes&#39;</span>)))</span>
<span id="cb31-15"><a href="fig-3.html#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="fig-3.html#cb31-16" aria-hidden="true" tabindex="-1"></a>meta <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="st">&#39;data/amplicon/stool/combined_2_meta_expanded.csv&#39;</span>)</span>
<span id="cb31-17"><a href="fig-3.html#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="fig-3.html#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb31-19"><a href="fig-3.html#cb31-19" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-20"><a href="fig-3.html#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">tox =</span> meta<span class="sc">$</span>tox,</span>
<span id="cb31-21"><a href="fig-3.html#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs3 =</span> meta<span class="sc">$</span>crs3,</span>
<span id="cb31-22"><a href="fig-3.html#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">cr100 =</span> meta<span class="sc">$</span>cr100,</span>
<span id="cb31-23"><a href="fig-3.html#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> meta<span class="sc">$</span>loca,</span>
<span id="cb31-24"><a href="fig-3.html#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">logdiv_s =</span> meta<span class="sc">$</span>logdiv_s</span>
<span id="cb31-25"><a href="fig-3.html#cb31-25" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `crs3`.</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="fig-3.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome: toxicity</span></span>
<span id="cb33-2"><a href="fig-3.html#cb33-2" aria-hidden="true" tabindex="-1"></a>mtox <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb33-3"><a href="fig-3.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb33-4"><a href="fig-3.html#cb33-4" aria-hidden="true" tabindex="-1"></a>        tox <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) ,</span>
<span id="cb33-5"><a href="fig-3.html#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> b<span class="sc">*</span>logdiv_s <span class="sc">+</span> a[location] ,</span>
<span id="cb33-6"><a href="fig-3.html#cb33-6" aria-hidden="true" tabindex="-1"></a>        b <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">2</span>), </span>
<span id="cb33-7"><a href="fig-3.html#cb33-7" aria-hidden="true" tabindex="-1"></a>        a[location] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb33-8"><a href="fig-3.html#cb33-8" aria-hidden="true" tabindex="-1"></a>    ) , <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span> , <span class="at">cores =</span> <span class="dv">16</span>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -mmacosx-version-min=10.13 -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="fig-3.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make the forest plot </span></span>
<span id="cb35-2"><a href="fig-3.html#cb35-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">precis</span>(mtox,  <span class="at">prob =</span> <span class="fl">0.95</span>)  <span class="sc">%&gt;%</span> <span class="fu">as.tibble</span>()</span></code></pre></div>
<pre><code>## Warning: `as.tibble()` was deprecated in tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="fig-3.html#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="fig-3.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">&#39;simpson_reciprocal&#39;</span>)</span>
<span id="cb37-3"><a href="fig-3.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#remove row number 1 (The intercept)</span></span>
<span id="cb37-4"><a href="fig-3.html#cb37-4" aria-hidden="true" tabindex="-1"></a>forest <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="fig-3.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, mean), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb37-6"><a href="fig-3.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">15</span>,</span>
<span id="cb37-7"><a href="fig-3.html#cb37-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size  =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb37-8"><a href="fig-3.html#cb37-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="fig-3.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin  =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb37-10"><a href="fig-3.html#cb37-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax  =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>),</span>
<span id="cb37-11"><a href="fig-3.html#cb37-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb37-12"><a href="fig-3.html#cb37-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">size  =</span> <span class="fl">0.7</span>,</span>
<span id="cb37-13"><a href="fig-3.html#cb37-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;turquoise4&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-14"><a href="fig-3.html#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb37-15"><a href="fig-3.html#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlab(&quot;Variables&quot;) + ylab(&quot;Coefficient with 95% CI&quot;) +</span></span>
<span id="cb37-16"><a href="fig-3.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.7</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb37-17"><a href="fig-3.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-18"><a href="fig-3.html#cb37-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb37-19"><a href="fig-3.html#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb37-20"><a href="fig-3.html#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;95% confidence interval of the coefficients</span><span class="sc">\n</span><span class="st">for standardized log transformed alpha diversity when outcome is toxicity&#39;</span>,</span>
<span id="cb37-21"><a href="fig-3.html#cb37-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb37-22"><a href="fig-3.html#cb37-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Association with Toxicity&#39;</span>) </span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: width</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="fig-3.html#cb39-1" aria-hidden="true" tabindex="-1"></a>forest </span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="fig-3.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/bayesian_div_tox.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">plot =</span> forest)</span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="fig-3.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome : CR_d100</span></span>
<span id="cb43-2"><a href="fig-3.html#cb43-2" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">ulam</span>( </span>
<span id="cb43-3"><a href="fig-3.html#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>( </span>
<span id="cb43-4"><a href="fig-3.html#cb43-4" aria-hidden="true" tabindex="-1"></a>        cr100 <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) ,</span>
<span id="cb43-5"><a href="fig-3.html#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> b<span class="sc">*</span>logdiv_s <span class="sc">+</span> a[location] ,</span>
<span id="cb43-6"><a href="fig-3.html#cb43-6" aria-hidden="true" tabindex="-1"></a>        b <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">2</span>),  </span>
<span id="cb43-7"><a href="fig-3.html#cb43-7" aria-hidden="true" tabindex="-1"></a>        a[location] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb43-8"><a href="fig-3.html#cb43-8" aria-hidden="true" tabindex="-1"></a>    ) , <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span> , <span class="at">cores =</span> <span class="dv">8</span>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -mmacosx-version-min=10.13 -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="fig-3.html#cb45-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">precis</span>(mcr,  <span class="at">prob =</span> <span class="fl">0.95</span>)  <span class="sc">%&gt;%</span> <span class="fu">as.tibble</span>()</span>
<span id="cb45-2"><a href="fig-3.html#cb45-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="fig-3.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">&#39;simpson_reciprocal&#39;</span>)</span>
<span id="cb45-4"><a href="fig-3.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#remove row number 1 (The intercept)</span></span>
<span id="cb45-5"><a href="fig-3.html#cb45-5" aria-hidden="true" tabindex="-1"></a>forest <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="fig-3.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, mean), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb45-7"><a href="fig-3.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">15</span>,</span>
<span id="cb45-8"><a href="fig-3.html#cb45-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">size  =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb45-9"><a href="fig-3.html#cb45-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-10"><a href="fig-3.html#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin  =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb45-11"><a href="fig-3.html#cb45-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax  =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>),</span>
<span id="cb45-12"><a href="fig-3.html#cb45-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb45-13"><a href="fig-3.html#cb45-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">size  =</span> <span class="fl">0.7</span>,</span>
<span id="cb45-14"><a href="fig-3.html#cb45-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;turquoise4&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-15"><a href="fig-3.html#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb45-16"><a href="fig-3.html#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variables&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Coefficient with 95% CI&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-17"><a href="fig-3.html#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.7</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb45-18"><a href="fig-3.html#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-19"><a href="fig-3.html#cb45-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb45-20"><a href="fig-3.html#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb45-21"><a href="fig-3.html#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;95% confidence interval of the coefficients</span><span class="sc">\n</span><span class="st">for standardized log transformed alpha diversity when outcome is CR&#39;</span>) </span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: width</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="fig-3.html#cb47-1" aria-hidden="true" tabindex="-1"></a>forest</span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="fig-3.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/bayesian_div_cr.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">plot =</span> forest)</span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
</div>
<div id="fig-3g-bayesian-modeling-with-5-genera-abundance-as-predictoroutcome-cr" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Fig 3G Bayesian modeling with 5 genera abundance as predictor(outcome CR)</h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="fig-3.html#cb51-1" aria-hidden="true" tabindex="-1"></a>genera <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/amplicon/stool/combined_5_genera.csv&#39;</span>)</span>
<span id="cb51-2"><a href="fig-3.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># do not standardize the log transformed relative abundance </span></span>
<span id="cb51-3"><a href="fig-3.html#cb51-3" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/amplicon/stool/combined_2_meta_expanded.csv&#39;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="fig-3.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(genera)</span>
<span id="cb51-5"><a href="fig-3.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="fig-3.html#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="fig-3.html#cb51-7" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb51-8"><a href="fig-3.html#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">tox =</span> meta<span class="sc">$</span>tox,</span>
<span id="cb51-9"><a href="fig-3.html#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cr100 =</span> meta<span class="sc">$</span>cr100,</span>
<span id="cb51-10"><a href="fig-3.html#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> meta<span class="sc">$</span>loca,</span>
<span id="cb51-11"><a href="fig-3.html#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Akkermansia =</span> meta<span class="sc">$</span>Akkermansia,</span>
<span id="cb51-12"><a href="fig-3.html#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Bacteroides =</span> meta<span class="sc">$</span>Bacteroides,</span>
<span id="cb51-13"><a href="fig-3.html#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Enterococcus =</span> meta<span class="sc">$</span>Enterococcus,</span>
<span id="cb51-14"><a href="fig-3.html#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Faecalibacterium =</span> meta<span class="sc">$</span>Faecalibacterium,</span>
<span id="cb51-15"><a href="fig-3.html#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ruminococcus =</span> meta<span class="sc">$</span>Ruminococcus</span>
<span id="cb51-16"><a href="fig-3.html#cb51-16" aria-hidden="true" tabindex="-1"></a>    ) </span></code></pre></div>
<p>CR ~ Akkermansia + Bacteroides + Enterococcus + Faecalibacterium + Ruminococcus + center</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="fig-3.html#cb52-1" aria-hidden="true" tabindex="-1"></a>gcr <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb52-2"><a href="fig-3.html#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb52-3"><a href="fig-3.html#cb52-3" aria-hidden="true" tabindex="-1"></a>        cr100 <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) ,</span>
<span id="cb52-4"><a href="fig-3.html#cb52-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> ba<span class="sc">*</span>Akkermansia <span class="sc">+</span> bb<span class="sc">*</span>Bacteroides <span class="sc">+</span> be<span class="sc">*</span>Enterococcus <span class="sc">+</span> bf<span class="sc">*</span>Faecalibacterium <span class="sc">+</span> br<span class="sc">*</span>Ruminococcus <span class="sc">+</span> a[location] ,</span>
<span id="cb52-5"><a href="fig-3.html#cb52-5" aria-hidden="true" tabindex="-1"></a>        ba <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb52-6"><a href="fig-3.html#cb52-6" aria-hidden="true" tabindex="-1"></a>        bb <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb52-7"><a href="fig-3.html#cb52-7" aria-hidden="true" tabindex="-1"></a>        be <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb52-8"><a href="fig-3.html#cb52-8" aria-hidden="true" tabindex="-1"></a>        bf <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb52-9"><a href="fig-3.html#cb52-9" aria-hidden="true" tabindex="-1"></a>        br <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb52-10"><a href="fig-3.html#cb52-10" aria-hidden="true" tabindex="-1"></a>        a[location] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb52-11"><a href="fig-3.html#cb52-11" aria-hidden="true" tabindex="-1"></a>    ) , <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span> , <span class="at">cores =</span> <span class="dv">16</span>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -mmacosx-version-min=10.13 -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="fig-3.html#cb54-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">precis</span>(gcr,  <span class="at">prob =</span> <span class="fl">0.95</span>)  <span class="sc">%&gt;%</span> <span class="fu">as.tibble</span>()</span>
<span id="cb54-2"><a href="fig-3.html#cb54-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="fig-3.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&#39;Akkermansia&#39;</span>, <span class="st">&#39;Bacteroides&#39;</span>,<span class="st">&#39;Enterococcus&#39;</span>,<span class="st">&#39;Faecalibacterium&#39;</span>,<span class="st">&#39;Ruminococcus&#39;</span>))</span>
<span id="cb54-4"><a href="fig-3.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#remove row number 1 (The intercept)</span></span>
<span id="cb54-5"><a href="fig-3.html#cb54-5" aria-hidden="true" tabindex="-1"></a>forest <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb54-6"><a href="fig-3.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="fig-3.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">15</span>,</span>
<span id="cb54-8"><a href="fig-3.html#cb54-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">size  =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb54-9"><a href="fig-3.html#cb54-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="fig-3.html#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin  =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb54-11"><a href="fig-3.html#cb54-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax  =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>),</span>
<span id="cb54-12"><a href="fig-3.html#cb54-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb54-13"><a href="fig-3.html#cb54-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">size  =</span> <span class="fl">0.7</span>,</span>
<span id="cb54-14"><a href="fig-3.html#cb54-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;turquoise4&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-15"><a href="fig-3.html#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb54-16"><a href="fig-3.html#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variables&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Coefficient with 95% CI&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-17"><a href="fig-3.html#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-18"><a href="fig-3.html#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb54-19"><a href="fig-3.html#cb54-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb54-20"><a href="fig-3.html#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb54-21"><a href="fig-3.html#cb54-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;CR&#39;</span>) </span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: width</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="fig-3.html#cb56-1" aria-hidden="true" tabindex="-1"></a>forest </span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="fig-3.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/bayesian_genera_cr_log10.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">plot =</span> forest)</span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
</div>
<div id="fig3h-histogram-to-illustrate-the-predicted-probability-of-day100-cr" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Fig3H Histogram to illustrate the predicted probability of day100 CR</h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="fig-3.html#cb60-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(gcr) </span>
<span id="cb60-2"><a href="fig-3.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="fig-3.html#cb60-3" aria-hidden="true" tabindex="-1"></a>meta_ <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="fig-3.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Akkermansia<span class="sc">:</span>Ruminococcus)</span>
<span id="cb60-5"><a href="fig-3.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="fig-3.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the post coeffs in df format</span></span>
<span id="cb60-7"><a href="fig-3.html#cb60-7" aria-hidden="true" tabindex="-1"></a>postdf <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">ba =</span> post<span class="sc">$</span>ba, <span class="at">bb =</span> post<span class="sc">$</span>bb, <span class="at">be =</span> post<span class="sc">$</span>be, <span class="at">bf =</span> post<span class="sc">$</span>bf, <span class="at">br =</span> post<span class="sc">$</span>br, <span class="at">am =</span> post<span class="sc">$</span>a[,<span class="dv">1</span>])</span>
<span id="cb60-8"><a href="fig-3.html#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="fig-3.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use the 90% and 10% quantile patient data in terms of ruminococcus relab</span></span>
<span id="cb60-10"><a href="fig-3.html#cb60-10" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb60-11"><a href="fig-3.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for the top and bottom quantile range of ruminococcus relab</span></span>
<span id="cb60-12"><a href="fig-3.html#cb60-12" aria-hidden="true" tabindex="-1"></a>ru_top <span class="ot">&lt;-</span> meta_ <span class="sc">%&gt;%</span> </span>
<span id="cb60-13"><a href="fig-3.html#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Ruminococcus <span class="sc">&gt;=</span> <span class="fu">quantile</span>(meta<span class="sc">$</span>Ruminococcus, <span class="fl">0.9</span>))</span>
<span id="cb60-14"><a href="fig-3.html#cb60-14" aria-hidden="true" tabindex="-1"></a>ru_bot <span class="ot">&lt;-</span> meta_ <span class="sc">%&gt;%</span> </span>
<span id="cb60-15"><a href="fig-3.html#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Ruminococcus <span class="sc">&lt;=</span> <span class="fu">quantile</span>(meta<span class="sc">$</span>Ruminococcus, <span class="fl">0.1</span>))</span>
<span id="cb60-16"><a href="fig-3.html#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="fig-3.html#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="fig-3.html#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co"># a function to calculate the predicted probability with the randomly drawn coeff from the posterior distributionn and the log10 transformed relative abundance</span></span>
<span id="cb60-19"><a href="fig-3.html#cb60-19" aria-hidden="true" tabindex="-1"></a>per_pt_sample_post_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(lga_, lgb_, lge_, lgf_ , lgr_){</span>
<span id="cb60-20"><a href="fig-3.html#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the input is the log relab of the 5 genera for that patient</span></span>
<span id="cb60-21"><a href="fig-3.html#cb60-21" aria-hidden="true" tabindex="-1"></a>  post_samp <span class="ot">&lt;-</span> postdf <span class="sc">%&gt;%</span> </span>
<span id="cb60-22"><a href="fig-3.html#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample_n</span>(<span class="at">size =</span> N, <span class="at">replace =</span> F)</span>
<span id="cb60-23"><a href="fig-3.html#cb60-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-24"><a href="fig-3.html#cb60-24" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">pmap</span>(post_samp, <span class="cf">function</span>(ba, bb, be, bf, br, am) {</span>
<span id="cb60-25"><a href="fig-3.html#cb60-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inv_logit</span>( ba <span class="sc">*</span> lga_ <span class="sc">+</span> bb <span class="sc">*</span> lgb_ <span class="sc">+</span> be <span class="sc">*</span> lge_ <span class="sc">+</span>  bf <span class="sc">*</span> lgf_ <span class="sc">+</span> br <span class="sc">*</span> lgr_ <span class="sc">+</span> am ) </span>
<span id="cb60-26"><a href="fig-3.html#cb60-26" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb60-27"><a href="fig-3.html#cb60-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="fu">seq</span>(<span class="dv">1</span>, N)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-28"><a href="fig-3.html#cb60-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-29"><a href="fig-3.html#cb60-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>()</span>
<span id="cb60-30"><a href="fig-3.html#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb60-31"><a href="fig-3.html#cb60-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-32"><a href="fig-3.html#cb60-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-33"><a href="fig-3.html#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="co"># for the top quantile patients </span></span>
<span id="cb60-34"><a href="fig-3.html#cb60-34" aria-hidden="true" tabindex="-1"></a>res_top <span class="ot">&lt;-</span> <span class="fu">pmap</span>(ru_top, <span class="cf">function</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus){</span>
<span id="cb60-35"><a href="fig-3.html#cb60-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">per_pt_sample_post_prob</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus)</span>
<span id="cb60-36"><a href="fig-3.html#cb60-36" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> </span>
<span id="cb60-37"><a href="fig-3.html#cb60-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste</span>(<span class="st">&#39;P&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(ru_top)), <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-38"><a href="fig-3.html#cb60-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;pt&#39;</span>)</span>
<span id="cb60-39"><a href="fig-3.html#cb60-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-40"><a href="fig-3.html#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="co"># for the bottom quantile patients</span></span>
<span id="cb60-41"><a href="fig-3.html#cb60-41" aria-hidden="true" tabindex="-1"></a>res_bot <span class="ot">&lt;-</span> <span class="fu">pmap</span>(ru_bot, <span class="cf">function</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus){</span>
<span id="cb60-42"><a href="fig-3.html#cb60-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">per_pt_sample_post_prob</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus)</span>
<span id="cb60-43"><a href="fig-3.html#cb60-43" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> </span>
<span id="cb60-44"><a href="fig-3.html#cb60-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste</span>(<span class="st">&#39;P&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(ru_bot)), <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-45"><a href="fig-3.html#cb60-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;pt&#39;</span>)</span>
<span id="cb60-46"><a href="fig-3.html#cb60-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-47"><a href="fig-3.html#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="co"># plot them together in one </span></span>
<span id="cb60-48"><a href="fig-3.html#cb60-48" aria-hidden="true" tabindex="-1"></a>Ruminococcus <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb60-49"><a href="fig-3.html#cb60-49" aria-hidden="true" tabindex="-1"></a>  res_top <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;high Ruminococcus&#39;</span>),</span>
<span id="cb60-50"><a href="fig-3.html#cb60-50" aria-hidden="true" tabindex="-1"></a>  res_bot <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;low Ruminococcus&#39;</span>)</span>
<span id="cb60-51"><a href="fig-3.html#cb60-51" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-52"><a href="fig-3.html#cb60-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghistogram</span>(<span class="at">x =</span> <span class="st">&#39;value&#39;</span>,<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&#39;grp&#39;</span>, <span class="at">palette =</span> <span class="st">&#39;nejm&#39;</span>, <span class="at">color =</span> <span class="st">&#39;white&#39;</span>, <span class="at">add =</span> <span class="st">&#39;mean&#39;</span>,</span>
<span id="cb60-53"><a href="fig-3.html#cb60-53" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">&#39;Predicted probability of CR d100&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Probability density&#39;</span>)</span>
<span id="cb60-54"><a href="fig-3.html#cb60-54" aria-hidden="true" tabindex="-1"></a>Ruminococcus  </span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="fig-3.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/predicted_CR_Ruminococcus_top_bottom_10.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">plot =</span> Ruminococcus)</span>
<span id="cb61-2"><a href="fig-3.html#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="fig-3.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb61-4"><a href="fig-3.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  res_top <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;high Ruminococcus&#39;</span>),</span>
<span id="cb61-5"><a href="fig-3.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  res_bot <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;low Ruminococcus&#39;</span>)</span>
<span id="cb61-6"><a href="fig-3.html#cb61-6" aria-hidden="true" tabindex="-1"></a>)  <span class="sc">%&gt;%</span> </span>
<span id="cb61-7"><a href="fig-3.html#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(grp) <span class="sc">%&gt;%</span> </span>
<span id="cb61-8"><a href="fig-3.html#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ave =</span> <span class="fu">mean</span>(value))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   grp                 ave
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 high Ruminococcus 0.699
## 2 low Ruminococcus  0.258</code></pre>
<p>As can be observed from the histogram, when the patients have high Ruminococcus content (relative abundance in the top 10% of the current patient cohort), they are predicted to have on average a probability of 0.67 to have CR at day 100; whereas when they have low Ruminococcus content (relative abundance in the bottom 10% of the current patient cohort), they are predicted to have only on average a probability of 0.27 to have CR at day 100.</p>
</div>
<div id="fig-3i-bayesian-modeling-with-5-genera-abundance-as-predictoroutcome-toxicity" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Fig 3I Bayesian modeling with 5 genera abundance as predictor(outcome toxicity)</h2>
<p>Toxicity ~ Akkermansia + Bacteroides + Enterococcus + Faecalibacterium + Ruminococcus + center</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="fig-3.html#cb63-1" aria-hidden="true" tabindex="-1"></a>gtox <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb63-2"><a href="fig-3.html#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb63-3"><a href="fig-3.html#cb63-3" aria-hidden="true" tabindex="-1"></a>        tox <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) ,</span>
<span id="cb63-4"><a href="fig-3.html#cb63-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> ba<span class="sc">*</span>Akkermansia <span class="sc">+</span> bb<span class="sc">*</span>Bacteroides <span class="sc">+</span> be<span class="sc">*</span>Enterococcus <span class="sc">+</span> bf<span class="sc">*</span>Faecalibacterium <span class="sc">+</span> br<span class="sc">*</span>Ruminococcus <span class="sc">+</span> a[location] ,</span>
<span id="cb63-5"><a href="fig-3.html#cb63-5" aria-hidden="true" tabindex="-1"></a>        ba <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb63-6"><a href="fig-3.html#cb63-6" aria-hidden="true" tabindex="-1"></a>        bb <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb63-7"><a href="fig-3.html#cb63-7" aria-hidden="true" tabindex="-1"></a>        be <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb63-8"><a href="fig-3.html#cb63-8" aria-hidden="true" tabindex="-1"></a>        bf <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb63-9"><a href="fig-3.html#cb63-9" aria-hidden="true" tabindex="-1"></a>        br <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb63-10"><a href="fig-3.html#cb63-10" aria-hidden="true" tabindex="-1"></a>        a[location] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb63-11"><a href="fig-3.html#cb63-11" aria-hidden="true" tabindex="-1"></a>    ) , <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span> , <span class="at">cores =</span> <span class="dv">16</span>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -mmacosx-version-min=10.13 -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.1/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="fig-3.html#cb65-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">precis</span>(gtox,  <span class="at">prob =</span> <span class="fl">0.95</span>)  <span class="sc">%&gt;%</span> <span class="fu">as.tibble</span>()</span>
<span id="cb65-2"><a href="fig-3.html#cb65-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="fig-3.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&#39;Akkermansia&#39;</span>, <span class="st">&#39;Bacteroides&#39;</span>,<span class="st">&#39;Enterococcus&#39;</span>,<span class="st">&#39;Faecalibacterium&#39;</span>,<span class="st">&#39;Ruminococcus&#39;</span>))</span>
<span id="cb65-4"><a href="fig-3.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#remove row number 1 (The intercept)</span></span>
<span id="cb65-5"><a href="fig-3.html#cb65-5" aria-hidden="true" tabindex="-1"></a>forest <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb65-6"><a href="fig-3.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb65-7"><a href="fig-3.html#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">15</span>,</span>
<span id="cb65-8"><a href="fig-3.html#cb65-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">size  =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb65-9"><a href="fig-3.html#cb65-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-10"><a href="fig-3.html#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin  =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb65-11"><a href="fig-3.html#cb65-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax  =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>),</span>
<span id="cb65-12"><a href="fig-3.html#cb65-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb65-13"><a href="fig-3.html#cb65-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">size  =</span> <span class="fl">0.7</span>,</span>
<span id="cb65-14"><a href="fig-3.html#cb65-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span><span class="st">&quot;turquoise4&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-15"><a href="fig-3.html#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb65-16"><a href="fig-3.html#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variables&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Coefficient with 95% CI&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-17"><a href="fig-3.html#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb65-18"><a href="fig-3.html#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb65-19"><a href="fig-3.html#cb65-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb65-20"><a href="fig-3.html#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb65-21"><a href="fig-3.html#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Toxicity&#39;</span>) </span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: width</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="fig-3.html#cb67-1" aria-hidden="true" tabindex="-1"></a>forest </span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="fig-3.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/amplicon/bayesian_genera_tox_log10.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">plot =</span> forest)</span></code></pre></div>
<pre><code>## Warning: Width not defined. Set with `position_dodge(width = ?)`</code></pre>
</div>
<div id="fig3j-histogram-to-illustrate-the-predicted-probability-of-toxicity" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Fig3J Histogram to illustrate the predicted probability of toxicity</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="fig-3.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior samples </span></span>
<span id="cb71-2"><a href="fig-3.html#cb71-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(gtox) </span>
<span id="cb71-3"><a href="fig-3.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="fig-3.html#cb71-4" aria-hidden="true" tabindex="-1"></a>meta_ <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span> </span>
<span id="cb71-5"><a href="fig-3.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Akkermansia<span class="sc">:</span>Ruminococcus)</span>
<span id="cb71-6"><a href="fig-3.html#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="fig-3.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the post coeffs in df format</span></span>
<span id="cb71-8"><a href="fig-3.html#cb71-8" aria-hidden="true" tabindex="-1"></a>postdf <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">ba =</span> post<span class="sc">$</span>ba, <span class="at">bb =</span> post<span class="sc">$</span>bb, <span class="at">be =</span> post<span class="sc">$</span>be, <span class="at">bf =</span> post<span class="sc">$</span>bf, <span class="at">br =</span> post<span class="sc">$</span>br, <span class="at">am =</span> post<span class="sc">$</span>a[,<span class="dv">1</span>])</span>
<span id="cb71-9"><a href="fig-3.html#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="fig-3.html#cb71-10" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb71-11"><a href="fig-3.html#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for the top and bottom quantile range of Bacteroides relab (top and bottom 10%)</span></span>
<span id="cb71-12"><a href="fig-3.html#cb71-12" aria-hidden="true" tabindex="-1"></a>ba_top <span class="ot">&lt;-</span> meta_ <span class="sc">%&gt;%</span> </span>
<span id="cb71-13"><a href="fig-3.html#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Bacteroides <span class="sc">&gt;=</span> <span class="fu">quantile</span>(meta<span class="sc">$</span>Bacteroides, <span class="fl">0.9</span>))</span>
<span id="cb71-14"><a href="fig-3.html#cb71-14" aria-hidden="true" tabindex="-1"></a>ba_bot <span class="ot">&lt;-</span> meta_ <span class="sc">%&gt;%</span> </span>
<span id="cb71-15"><a href="fig-3.html#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Bacteroides <span class="sc">&lt;=</span> <span class="fu">quantile</span>(meta<span class="sc">$</span>Bacteroides, <span class="fl">0.1</span>))</span>
<span id="cb71-16"><a href="fig-3.html#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="fig-3.html#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co"># a function to calculate the predicted probability with the randomly drawn coeff from the posterior distributionn and the log10 transformed relative abundance</span></span>
<span id="cb71-18"><a href="fig-3.html#cb71-18" aria-hidden="true" tabindex="-1"></a>per_pt_sample_post_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(lga_, lgb_, lge_, lgf_ , lgr_){</span>
<span id="cb71-19"><a href="fig-3.html#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the input is the log relab of the 5 genera for that patient</span></span>
<span id="cb71-20"><a href="fig-3.html#cb71-20" aria-hidden="true" tabindex="-1"></a>  post_samp <span class="ot">&lt;-</span> postdf <span class="sc">%&gt;%</span> </span>
<span id="cb71-21"><a href="fig-3.html#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample_n</span>(<span class="at">size =</span> N, <span class="at">replace =</span> F)</span>
<span id="cb71-22"><a href="fig-3.html#cb71-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-23"><a href="fig-3.html#cb71-23" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">pmap</span>(post_samp, <span class="cf">function</span>(ba, bb, be, bf, br, am) {</span>
<span id="cb71-24"><a href="fig-3.html#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inv_logit</span>( ba <span class="sc">*</span> lga_ <span class="sc">+</span> bb <span class="sc">*</span> lgb_ <span class="sc">+</span> be <span class="sc">*</span> lge_ <span class="sc">+</span>  bf <span class="sc">*</span> lgf_ <span class="sc">+</span> br <span class="sc">*</span> lgr_ <span class="sc">+</span> am ) </span>
<span id="cb71-25"><a href="fig-3.html#cb71-25" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb71-26"><a href="fig-3.html#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="fu">seq</span>(<span class="dv">1</span>, N)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-27"><a href="fig-3.html#cb71-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb71-28"><a href="fig-3.html#cb71-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>()</span>
<span id="cb71-29"><a href="fig-3.html#cb71-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb71-30"><a href="fig-3.html#cb71-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-31"><a href="fig-3.html#cb71-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-32"><a href="fig-3.html#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="co"># for the top quantile patients </span></span>
<span id="cb71-33"><a href="fig-3.html#cb71-33" aria-hidden="true" tabindex="-1"></a>res_top <span class="ot">&lt;-</span> <span class="fu">pmap</span>(ba_top, <span class="cf">function</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus){</span>
<span id="cb71-34"><a href="fig-3.html#cb71-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">per_pt_sample_post_prob</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus)</span>
<span id="cb71-35"><a href="fig-3.html#cb71-35" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> </span>
<span id="cb71-36"><a href="fig-3.html#cb71-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste</span>(<span class="st">&#39;P&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(ba_top)), <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-37"><a href="fig-3.html#cb71-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;pt&#39;</span>)</span>
<span id="cb71-38"><a href="fig-3.html#cb71-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-39"><a href="fig-3.html#cb71-39" aria-hidden="true" tabindex="-1"></a><span class="co"># for the bottom quantile patients  </span></span>
<span id="cb71-40"><a href="fig-3.html#cb71-40" aria-hidden="true" tabindex="-1"></a>res_bot <span class="ot">&lt;-</span> <span class="fu">pmap</span>(ba_bot, <span class="cf">function</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus){</span>
<span id="cb71-41"><a href="fig-3.html#cb71-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">per_pt_sample_post_prob</span>(Akkermansia, Bacteroides, Enterococcus, Faecalibacterium, Ruminococcus)</span>
<span id="cb71-42"><a href="fig-3.html#cb71-42" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> </span>
<span id="cb71-43"><a href="fig-3.html#cb71-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste</span>(<span class="st">&#39;P&#39;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(ba_bot)), <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-44"><a href="fig-3.html#cb71-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;pt&#39;</span>) </span>
<span id="cb71-45"><a href="fig-3.html#cb71-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-46"><a href="fig-3.html#cb71-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot them together in one </span></span>
<span id="cb71-47"><a href="fig-3.html#cb71-47" aria-hidden="true" tabindex="-1"></a>bacteroides <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb71-48"><a href="fig-3.html#cb71-48" aria-hidden="true" tabindex="-1"></a>  res_top <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;top&#39;</span>),</span>
<span id="cb71-49"><a href="fig-3.html#cb71-49" aria-hidden="true" tabindex="-1"></a>  res_bot <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="st">&#39;bot&#39;</span>)</span>
<span id="cb71-50"><a href="fig-3.html#cb71-50" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-51"><a href="fig-3.html#cb71-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghistogram</span>(<span class="at">x =</span> <span class="st">&#39;value&#39;</span>,<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&#39;grp&#39;</span>, <span class="at">palette =</span> <span class="st">&#39;nejm&#39;</span>, <span class="at">color =</span> <span class="st">&#39;white&#39;</span>, <span class="at">add =</span> <span class="st">&#39;mean&#39;</span>,</span>
<span id="cb71-52"><a href="fig-3.html#cb71-52" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">&#39;Predicted probability of Toxicity&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Probability density&#39;</span>) </span>
<span id="cb71-53"><a href="fig-3.html#cb71-53" aria-hidden="true" tabindex="-1"></a>bacteroides  </span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="fig-3.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;figs/predicted_tox_bacteroides_top_bottom_10.pdf&#39;</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">plot =</span> bacteroides)</span></code></pre></div>
<p>As can be observed from the histogram, when the patients have high Bacteroides content (relative abundance in the top 10% of the current patient cohort), they are predicted to almost always have a toxicity response: the histogram amassed on the right side of 0.5; whereas when the patients have low Bacteroides content (relative abundance in the bottom 10% of the current patient cohort), the patients are predicted to have no inclination towards whether or not to have a toxicity response.</p>
</div>
<div id="fig-3k-lefse-of-pathway-abundance-using-shotgun-data" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Fig 3K lefse of pathway abundance using shotgun data</h2>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="fig-3.html#cb73-1" aria-hidden="true" tabindex="-1"></a>simple <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/shotgun/final_comprehensive_UPDATED_simple.csv&#39;</span>)</span>
<span id="cb73-2"><a href="fig-3.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="fig-3.html#cb73-3" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> simple <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="fig-3.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;pheno&#39;</span>, <span class="st">&#39;value&#39;</span>, cr_d100<span class="sc">:</span>toxicity) </span>
<span id="cb73-5"><a href="fig-3.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="fig-3.html#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the pathway counts table</span></span>
<span id="cb73-7"><a href="fig-3.html#cb73-7" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">&#39;data/shotgun/humann3_pathabundance_cpm_joined_unstratified.tsv&#39;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb73-8"><a href="fig-3.html#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace</span>(., <span class="st">&#39;^CART_&#39;</span>,<span class="st">&#39;&#39;</span>)))  <span class="sc">%&gt;%</span> </span>
<span id="cb73-9"><a href="fig-3.html#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace</span>(., <span class="st">&#39;_humann3$&#39;</span>,<span class="st">&#39;&#39;</span>)))</span></code></pre></div>
<pre><code>## Warning: `funs()` was deprecated in dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="fig-3.html#cb75-1" aria-hidden="true" tabindex="-1"></a>all_sub_pheno <span class="ot">&lt;-</span> pheno <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="fig-3.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(., <span class="fu">list</span>(.<span class="sc">$</span>pheno)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="fig-3.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">imap</span>(<span class="sc">~</span> <span class="fu">filter</span>(<span class="at">.data =</span> ., value <span class="sc">!=</span> <span class="st">&#39;not_assessed&#39;</span>))</span>
<span id="cb75-4"><a href="fig-3.html#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="fig-3.html#cb75-5" aria-hidden="true" tabindex="-1"></a>all_sub_pheno <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="fig-3.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="cf">function</span>(.x, .y){</span>
<span id="cb75-7"><a href="fig-3.html#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">.data =</span> .x, value) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="fig-3.html#cb75-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb75-9"><a href="fig-3.html#cb75-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(<span class="fu">str_glue</span>(<span class="st">&#39;data/shotgun/pull_{.y}.txt&#39;</span>), <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F, <span class="at">row.names =</span> T, <span class="at">col.names =</span> F)</span>
<span id="cb75-10"><a href="fig-3.html#cb75-10" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<pre><code>## $cr_d100
## NULL
## 
## $toxicity
## NULL</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="fig-3.html#cb77-1" aria-hidden="true" tabindex="-1"></a>all_pcts <span class="ot">&lt;-</span> all_sub_pheno <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="fig-3.html#cb77-2" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">pull</span>(<span class="at">.data =</span> ., fid) ) <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="fig-3.html#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="sc">~</span> full <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">`</span><span class="at"># Pathway</span><span class="st">`</span>, <span class="fu">matches</span>(.x)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-4"><a href="fig-3.html#cb77-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">write_tsv</span>(<span class="fu">str_glue</span>(<span class="st">&#39;data/shotgun/pull_{.y}_pcts.tsv&#39;</span>)))</span>
<span id="cb77-5"><a href="fig-3.html#cb77-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb77-6"><a href="fig-3.html#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"># then move to Snakemake do the normalization and the split</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="fig-3.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a filtering step here </span></span>
<span id="cb78-2"><a href="fig-3.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 50 and 25% </span></span>
<span id="cb78-3"><a href="fig-3.html#cb78-3" aria-hidden="true" tabindex="-1"></a>pcts <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">&#39;data/shotgun/pull_cr_d100_pcts_cpm_unstratified.tsv&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="fig-3.html#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;cpm&#39;</span>, <span class="fu">names</span>(.)[<span class="dv">2</span>]<span class="sc">:</span><span class="fu">names</span>(.)[<span class="fu">ncol</span>(.)]) <span class="sc">%&gt;%</span> </span>
<span id="cb78-5"><a href="fig-3.html#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pw =</span> <span class="st">`</span><span class="at"># Pathway</span><span class="st">`</span>)</span>
<span id="cb78-6"><a href="fig-3.html#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="fig-3.html#cb78-7" aria-hidden="true" tabindex="-1"></a>keeppw <span class="ot">&lt;-</span> pcts <span class="sc">%&gt;%</span> </span>
<span id="cb78-8"><a href="fig-3.html#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cpm <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-9"><a href="fig-3.html#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb78-10"><a href="fig-3.html#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pw) <span class="sc">%&gt;%</span> </span>
<span id="cb78-11"><a href="fig-3.html#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(simple) <span class="sc">*</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-12"><a href="fig-3.html#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(pw)</span>
<span id="cb78-13"><a href="fig-3.html#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="fig-3.html#cb78-14" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="ot">&lt;-</span> pcts <span class="sc">%&gt;%</span> </span>
<span id="cb78-15"><a href="fig-3.html#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pw <span class="sc">%in%</span> keeppw) <span class="sc">%&gt;%</span> </span>
<span id="cb78-16"><a href="fig-3.html#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;cpm&#39;</span>, <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb78-17"><a href="fig-3.html#cb78-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-18"><a href="fig-3.html#cb78-18" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="sc">%&gt;%</span> </span>
<span id="cb78-19"><a href="fig-3.html#cb78-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_tsv</span>(<span class="st">&#39;data/shotgun/pull_cr_d100_pcts_cpm_unstratified_fil.tsv&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="fig-3.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tox</span></span>
<span id="cb79-2"><a href="fig-3.html#cb79-2" aria-hidden="true" tabindex="-1"></a>pcts <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">&#39;data/shotgun/pull_toxicity_pcts_cpm_unstratified.tsv&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="fig-3.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;cpm&#39;</span>, <span class="fu">names</span>(.)[<span class="dv">2</span>]<span class="sc">:</span><span class="fu">names</span>(.)[<span class="fu">ncol</span>(.)]) <span class="sc">%&gt;%</span> </span>
<span id="cb79-4"><a href="fig-3.html#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pw =</span> <span class="st">`</span><span class="at"># Pathway</span><span class="st">`</span>)</span>
<span id="cb79-5"><a href="fig-3.html#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="fig-3.html#cb79-6" aria-hidden="true" tabindex="-1"></a>keeppw <span class="ot">&lt;-</span> pcts <span class="sc">%&gt;%</span> </span>
<span id="cb79-7"><a href="fig-3.html#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cpm <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-8"><a href="fig-3.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb79-9"><a href="fig-3.html#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pw) <span class="sc">%&gt;%</span> </span>
<span id="cb79-10"><a href="fig-3.html#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(simple) <span class="sc">*</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-11"><a href="fig-3.html#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(pw)</span>
<span id="cb79-12"><a href="fig-3.html#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="fig-3.html#cb79-13" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="ot">&lt;-</span> pcts <span class="sc">%&gt;%</span> </span>
<span id="cb79-14"><a href="fig-3.html#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pw <span class="sc">%in%</span> keeppw) <span class="sc">%&gt;%</span> </span>
<span id="cb79-15"><a href="fig-3.html#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="st">&#39;sampleid&#39;</span>, <span class="st">&#39;cpm&#39;</span>, <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb79-16"><a href="fig-3.html#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="fig-3.html#cb79-17" aria-hidden="true" tabindex="-1"></a>cts_fil <span class="sc">%&gt;%</span> </span>
<span id="cb79-18"><a href="fig-3.html#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_tsv</span>(<span class="st">&#39;data/shotgun/pull_toxicity_pcts_cpm_unstratified_fil.tsv&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="fig-3.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PATHWAY</span></span>
<span id="cb80-2"><a href="fig-3.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I already normalized the pcts so don&#39;t need to normalize again here </span></span>
<span id="cb80-3"><a href="fig-3.html#cb80-3" aria-hidden="true" tabindex="-1"></a>fns <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&#39;data/shotgun/&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;lefse_ready_pcts.tsv$&#39;</span>)</span>
<span id="cb80-4"><a href="fig-3.html#cb80-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-5"><a href="fig-3.html#cb80-5" aria-hidden="true" tabindex="-1"></a>cmds <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-6"><a href="fig-3.html#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fns =</span> fns</span>
<span id="cb80-7"><a href="fig-3.html#cb80-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-8"><a href="fig-3.html#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">format_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_format_input.py {fns}  {fns}.in -c 1 -u 2&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-9"><a href="fig-3.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">run_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_run.py {fns}.in  {fns}.res&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-10"><a href="fig-3.html#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">plot_cmd =</span> <span class="fu">str_glue</span>(<span class="st">&#39;lefse_plot_res.py {fns}.res {fns}.pdf --format pdf  --feature_font_size 4 --width 10 --dpi 300 --title {fns}&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-11"><a href="fig-3.html#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fns) <span class="sc">%&gt;%</span> </span>
<span id="cb80-12"><a href="fig-3.html#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-13"><a href="fig-3.html#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb80-14"><a href="fig-3.html#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&#39;data/shotgun/lefse_run_cmd.sh&#39;</span>, <span class="at">col_names =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="fig-3.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the pathway results</span></span>
<span id="cb81-2"><a href="fig-3.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdbR)</span>
<span id="cb81-3"><a href="fig-3.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">connect_database</span>(<span class="st">&#39;~/dbConfig.txt&#39;</span>)</span>
<span id="cb81-4"><a href="fig-3.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&#39;metacyc_pathway_name&#39;</span>)</span>
<span id="cb81-5"><a href="fig-3.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">get_table_from_database</span>(<span class="st">&#39;metacyc_pathway_ontology&#39;</span>)</span>
<span id="cb81-6"><a href="fig-3.html#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="fig-3.html#cb81-7" aria-hidden="true" tabindex="-1"></a>fns <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&#39;data/shotgun/&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;lefse_ready_pcts.tsv.res$&#39;</span>, <span class="at">full.names =</span> T)</span>
<span id="cb81-8"><a href="fig-3.html#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="fig-3.html#cb81-9" aria-hidden="true" tabindex="-1"></a>feature <span class="ot">&lt;-</span> fns <span class="sc">%&gt;%</span> </span>
<span id="cb81-10"><a href="fig-3.html#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(fns) <span class="sc">%&gt;%</span> </span>
<span id="cb81-11"><a href="fig-3.html#cb81-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">read_tsv</span>(., <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&#39;pathway&#39;</span>,<span class="st">&#39;xx&#39;</span>,<span class="st">&#39;direction&#39;</span>,<span class="st">&#39;score&#39;</span>,<span class="st">&#39;pval&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-12"><a href="fig-3.html#cb81-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(score))) <span class="sc">%&gt;%</span> </span>
<span id="cb81-13"><a href="fig-3.html#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">&#39;group&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-14"><a href="fig-3.html#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_replace</span>(group, <span class="st">&#39;data/shotgun//&#39;</span>,<span class="st">&#39;&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-15"><a href="fig-3.html#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_replace</span>(group, <span class="st">&#39;_lefse_ready_pcts.tsv.res$&#39;</span>,<span class="st">&#39;&#39;</span>)) </span>
<span id="cb81-16"><a href="fig-3.html#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="fig-3.html#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co"># change the &quot;N&quot; direction to be minus score</span></span>
<span id="cb81-18"><a href="fig-3.html#cb81-18" aria-hidden="true" tabindex="-1"></a>feature <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb81-19"><a href="fig-3.html#cb81-19" aria-hidden="true" tabindex="-1"></a>  feature <span class="sc">%&gt;%</span> </span>
<span id="cb81-20"><a href="fig-3.html#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.<span class="sc">$</span>direction) <span class="sc">%&gt;%</span> </span>
<span id="cb81-21"><a href="fig-3.html#cb81-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">&#39;no&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-22"><a href="fig-3.html#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">score =</span> <span class="sc">-</span>score),</span>
<span id="cb81-23"><a href="fig-3.html#cb81-23" aria-hidden="true" tabindex="-1"></a>  feature <span class="sc">%&gt;%</span> </span>
<span id="cb81-24"><a href="fig-3.html#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.<span class="sc">$</span>direction) <span class="sc">%&gt;%</span> </span>
<span id="cb81-25"><a href="fig-3.html#cb81-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">&#39;yes&#39;</span>)  </span>
<span id="cb81-26"><a href="fig-3.html#cb81-26" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-27"><a href="fig-3.html#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(group, pathway, score) <span class="sc">%&gt;%</span> </span>
<span id="cb81-28"><a href="fig-3.html#cb81-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pwid =</span> <span class="fu">str_extract</span>(pathway, <span class="st">&#39;^.+_PWY|^PWY.*_</span><span class="sc">\\</span><span class="st">d{3,4}&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-29"><a href="fig-3.html#cb81-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pwid =</span> <span class="fu">str_replace_all</span>(pwid, <span class="st">&#39;_&#39;</span>, <span class="st">&#39;-&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-30"><a href="fig-3.html#cb81-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pwid =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(pathway, <span class="st">&#39;^TCA&#39;</span>), <span class="st">&#39;TCA&#39;</span>, pwid)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-31"><a href="fig-3.html#cb81-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pwid =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(pathway, <span class="st">&#39;^NAD&#39;</span>), <span class="st">&#39;NAD-BIOSYNTHESIS-II&#39;</span>, pwid)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-32"><a href="fig-3.html#cb81-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(metacyc_pathway_name <span class="sc">%&gt;%</span> <span class="fu">select</span>(pwid, pw_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-33"><a href="fig-3.html#cb81-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(metacyc_pathway_ontology <span class="sc">%&gt;%</span> <span class="fu">select</span>(pwid, l4<span class="sc">:</span>l9))</span>
<span id="cb81-34"><a href="fig-3.html#cb81-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-35"><a href="fig-3.html#cb81-35" aria-hidden="true" tabindex="-1"></a>all_title_fs <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb81-36"><a href="fig-3.html#cb81-36" aria-hidden="true" tabindex="-1"></a>axis_text_fs <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb81-37"><a href="fig-3.html#cb81-37" aria-hidden="true" tabindex="-1"></a>CR <span class="ot">&lt;-</span> feature <span class="sc">%&gt;%</span> </span>
<span id="cb81-38"><a href="fig-3.html#cb81-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&#39;pull_cr_d100&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-39"><a href="fig-3.html#cb81-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(pathway, score), <span class="at">y =</span> score, <span class="at">fill =</span> direction)) <span class="sc">+</span></span>
<span id="cb81-40"><a href="fig-3.html#cb81-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_bar</span>( <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb81-41"><a href="fig-3.html#cb81-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb81-42"><a href="fig-3.html#cb81-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#925E9F&#39;</span>, <span class="st">&#39;#42B540&#39;</span>))  <span class="sc">+</span></span>
<span id="cb81-43"><a href="fig-3.html#cb81-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#925E9F&#39;</span>, <span class="st">&#39;#42B540&#39;</span>)) <span class="sc">+</span></span>
<span id="cb81-44"><a href="fig-3.html#cb81-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb81-45"><a href="fig-3.html#cb81-45" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb81-46"><a href="fig-3.html#cb81-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span>all_title_fs),</span>
<span id="cb81-47"><a href="fig-3.html#cb81-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb81-48"><a href="fig-3.html#cb81-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb81-49"><a href="fig-3.html#cb81-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.position=</span><span class="st">&#39;bottom&#39;</span>) <span class="sc">+</span></span>
<span id="cb81-50"><a href="fig-3.html#cb81-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">str_glue</span>(<span class="st">&#39;Response to CR&#39;</span>) ,</span>
<span id="cb81-51"><a href="fig-3.html#cb81-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="st">&#39;Score&#39;</span>)</span>
<span id="cb81-52"><a href="fig-3.html#cb81-52" aria-hidden="true" tabindex="-1"></a>CR</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="fig-3.html#cb82-1" aria-hidden="true" tabindex="-1"></a>tox <span class="ot">&lt;-</span> feature <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="fig-3.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&#39;pull_toxicity&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="fig-3.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(pathway, score), <span class="at">y =</span> score, <span class="at">fill =</span> direction)) <span class="sc">+</span></span>
<span id="cb82-4"><a href="fig-3.html#cb82-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="fig-3.html#cb82-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb82-6"><a href="fig-3.html#cb82-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#0099B4&#39;</span>, <span class="st">&#39;#AD002A&#39;</span>))  <span class="sc">+</span></span>
<span id="cb82-7"><a href="fig-3.html#cb82-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#0099B4&#39;</span>, <span class="st">&#39;#AD002A&#39;</span>)) <span class="sc">+</span></span>
<span id="cb82-8"><a href="fig-3.html#cb82-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb82-9"><a href="fig-3.html#cb82-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb82-10"><a href="fig-3.html#cb82-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb82-11"><a href="fig-3.html#cb82-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span>all_title_fs),</span>
<span id="cb82-12"><a href="fig-3.html#cb82-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span>axis_text_fs),</span>
<span id="cb82-13"><a href="fig-3.html#cb82-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-14"><a href="fig-3.html#cb82-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">str_glue</span>(<span class="st">&#39;Response to Toxicity&#39;</span>) ,</span>
<span id="cb82-15"><a href="fig-3.html#cb82-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="st">&#39;Score&#39;</span>)</span>
<span id="cb82-16"><a href="fig-3.html#cb82-16" aria-hidden="true" tabindex="-1"></a>tox</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="fig-3.html#cb83-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(CR,tox,  </span>
<span id="cb83-2"><a href="fig-3.html#cb83-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb83-3"><a href="fig-3.html#cb83-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb83-4"><a href="fig-3.html#cb83-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">&#39;hv&#39;</span>,</span>
<span id="cb83-5"><a href="fig-3.html#cb83-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis =</span> <span class="st">&#39;b&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="fig-3.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.1.1 (2021-08-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] rethinking_2.13      rstan_2.21.2         StanHeaders_2.21.0-7
##  [4] vegan_2.5-7          lattice_0.20-44      permute_0.9-5       
##  [7] ggpubr_0.4.0         vdbR_0.0.0.9000      RPostgreSQL_0.6-2   
## [10] DBI_1.1.1            Rtsne_0.15           ape_5.5             
## [13] labdsv_2.0-1         mgcv_1.8-36          nlme_3.1-152        
## [16] data.table_1.14.0    forcats_0.5.1        stringr_1.4.0       
## [19] dplyr_1.0.7          purrr_0.3.4          readr_2.0.1         
## [22] tidyr_1.1.3          tibble_3.1.4         ggplot2_3.3.5       
## [25] tidyverse_1.3.1     
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_2.0-2   ggsignif_0.6.2     ellipsis_0.3.2     rio_0.5.27        
##  [5] fs_1.5.0           rstudioapi_0.13    farver_2.1.0       bit64_4.0.5       
##  [9] mvtnorm_1.1-2      fansi_0.5.0        lubridate_1.7.10   xml2_1.3.2        
## [13] codetools_0.2-18   splines_4.1.1      knitr_1.33         jsonlite_1.7.2    
## [17] broom_0.7.9        cluster_2.1.2      dbplyr_2.1.1       compiler_4.1.1    
## [21] httr_1.4.2         backports_1.2.1    assertthat_0.2.1   Matrix_1.3-4      
## [25] fastmap_1.1.0      cli_3.0.1          htmltools_0.5.2    prettyunits_1.1.1 
## [29] tools_4.1.1        coda_0.19-4        gtable_0.3.0       glue_1.4.2        
## [33] V8_3.4.2           Rcpp_1.0.7         carData_3.0-4      cellranger_1.1.0  
## [37] jquerylib_0.1.4    vctrs_0.3.8        xfun_0.25          ps_1.6.0          
## [41] openxlsx_4.2.4     rvest_1.0.1        lifecycle_1.0.0    rstatix_0.7.0     
## [45] MASS_7.3-54        scales_1.1.1       vroom_1.5.4        hms_1.1.0         
## [49] inline_0.3.19      yaml_2.2.1         curl_4.3.2         gridExtra_2.3     
## [53] loo_2.4.1          stringi_1.7.4      highr_0.9          pkgbuild_1.2.0    
## [57] zip_2.2.0          shape_1.4.6        matrixStats_0.60.1 rlang_0.4.11      
## [61] pkgconfig_2.0.3    evaluate_0.14      labeling_0.4.2     cowplot_1.1.1     
## [65] bit_4.0.4          tidyselect_1.1.1   processx_3.5.2     ggsci_2.9         
## [69] magrittr_2.0.1     bookdown_0.24      R6_2.5.1           generics_0.1.0    
## [73] pillar_1.6.2       haven_2.4.3        foreign_0.8-81     withr_2.4.2       
## [77] abind_1.4-5        modelr_0.1.8       crayon_1.4.1       car_3.0-11        
## [81] utf8_1.2.2         tzdb_0.1.2         rmarkdown_2.10     grid_4.1.1        
## [85] readxl_1.3.1       callr_3.7.0        reprex_2.0.1       digest_0.6.27     
## [89] RcppParallel_5.1.4 stats4_4.1.1       munsell_0.5.0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["analysis.pdf", "analysis.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
